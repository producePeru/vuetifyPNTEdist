import{u as Me,b as pe,c as Ie,d as Ae,e as ne,f as Pe,g as De,h as Ke}from"./VSelect-ydnfoNAd.js";import{X as ce,s as L,j as C,E as U,M as _e,aM as ee,aN as Re,b as M,O as W,F as H,W as Le,a7 as Oe,r as z,a6 as Te,Y as Z,aO as Ee,m as $,K as ue,at as Ne,an as Be,D as oe,a as w,G as T,ao as je,aP as Ue,aQ as ze,aR as $e,aS as se,aT as ie,aU as We,V as re,aV as He,aW as Qe,aX as Xe,n as Ge,a9 as Ye,e as Je}from"./index-99AdKl_5.js";import{a as Ze}from"./VAvatar-jV72lSRD.js";const qe=(e,u,t)=>{if(e==null||u==null)return-1;if(!u.length)return 0;e=e.toString().toLocaleLowerCase(),u=u.toString().toLocaleLowerCase();const c=[];let o=e.indexOf(u);for(;~o;)c.push([o,o+u.length]),o=e.indexOf(u,o+u.length);return c.length?c:-1};function q(e,u){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+u.length]]:Array.isArray(e[0])?e:[e]}const el=ce({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ll(e,u,t){var A;const c=[],o=(t==null?void 0:t.default)??qe,g=t!=null&&t.filterKeys?ee(t.filterKeys):!1,y=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return c;e:for(let F=0;F<e.length;F++){const[b,i=b]=ee(e[F]),P={},p={};let k=-1;if((u||y>0)&&!(t!=null&&t.noFilter)){if(typeof b=="object"){const v=g||Object.keys(i);for(const a of v){const E=Re(i,a),D=(A=t==null?void 0:t.customKeyFilter)==null?void 0:A[a];if(k=D?D(E,u,b):o(E,u,b),k!==-1&&k!==!1)D?P[a]=q(k,u):p[a]=q(k,u);else if((t==null?void 0:t.filterMode)==="every")continue e}}else k=o(b,u,b),k!==-1&&k!==!1&&(p.title=q(k,u));const K=Object.keys(p).length,_=Object.keys(P).length;if(!K&&!_||(t==null?void 0:t.filterMode)==="union"&&_!==y&&!K||(t==null?void 0:t.filterMode)==="intersection"&&(_!==y||!K))continue}c.push({index:F,matches:{...p,...P}})}return c}function tl(e,u,t,c){const o=L([]),g=L(new Map),y=C(()=>U(u));_e(()=>{const F=typeof t=="function"?t():U(t),b=typeof F!="string"&&typeof F!="number"?"":String(F),i=ll(y.value,b,{customKeyFilter:{...e.customKeyFilter,...U(c==null?void 0:c.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),P=U(u),p=[],k=new Map;i.forEach(K=>{let{index:_,matches:v}=K;const a=P[_];p.push(a),k.set(a.value,v)}),o.value=p,g.value=k});function A(F){return g.value.get(F.value)}return{filteredItems:o,filteredMatches:g,getMatches:A}}function al(e,u,t){return t==null||!t.length?u:t.map((c,o)=>{const g=o===0?0:t[o-1][1],y=[M("span",{class:W(`${e}__unmask`)},[u.slice(g,c[0])]),M("span",{class:W(`${e}__mask`)},[u.slice(c[0],c[1])])];return o===t.length-1&&y.push(M("span",{class:W(`${e}__unmask`)},[u.slice(c[1])])),M(H,null,[y])})}const nl=ce({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...el({filterKeys:["title"]}),...Ie(),...ze($e({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ue({transition:!1})},"VAutocomplete"),il=Le()({name:"VAutocomplete",props:nl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,u){let{slots:t}=u;const{t:c}=Oe(),o=z(),g=L(!1),y=L(!0),A=L(!1),F=z(),b=z(),i=L(-1),{items:P,transformIn:p,transformOut:k}=Me(e),{textColorClasses:K,textColorStyles:_}=Te(()=>{var l;return(l=o.value)==null?void 0:l.color}),v=Z(e,"search",""),a=Z(e,"modelValue",[],l=>p(l===null?[null]:ee(l)),l=>{const n=k(l);return e.multiple?n:n[0]??null}),E=C(()=>typeof e.counterValue=="function"?e.counterValue(a.value):typeof e.counterValue=="number"?e.counterValue:a.value.length),D=Ee(e),{filteredItems:Q,getMatches:fe}=tl(e,P,()=>y.value?"":v.value),I=C(()=>e.hideSelected?Q.value.filter(l=>!a.value.some(n=>n.value===l.value)):Q.value),N=C(()=>!!(e.chips||t.chip)),O=C(()=>N.value||!!t.selection),ve=C(()=>a.value.map(l=>l.props.value)),X=C(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&v.value===((n=I.value[0])==null?void 0:n.title))&&I.value.length>0&&!y.value&&!A.value}),B=C(()=>e.hideNoData&&!I.value.length||D.isReadonly.value||D.isDisabled.value),G=Z(e,"menu"),m=C({get:()=>G.value,set:l=>{var n;G.value&&!l&&((n=F.value)!=null&&n.Î¨openChildren.size)||l&&B.value||(G.value=l)}}),le=C(()=>m.value?e.closeText:e.openText),Y=z(),de=pe(Y,o);function me(l){e.openOnClear&&(m.value=!0),v.value=""}function he(){B.value||(m.value=!0)}function ge(l){B.value||(g.value&&(l.preventDefault(),l.stopPropagation()),m.value=!m.value)}function ye(l){var n;l.key!==" "&&se(l)&&((n=o.value)==null||n.focus())}function Ve(l){var s,d,S,x,r;if(D.isReadonly.value)return;const n=(s=o.value)==null?void 0:s.selectionStart,f=a.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(m.value=!0),["Escape"].includes(l.key)&&(m.value=!1),X.value&&["Enter","Tab"].includes(l.key)&&!a.value.some(V=>{let{value:h}=V;return h===I.value[0].value})&&R(I.value[0]),l.key==="ArrowDown"&&X.value&&((d=Y.value)==null||d.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&O.value&&a.value.length>0&&!v.value)return R(a.value[0],!1);if(~i.value){l.preventDefault();const V=i.value;R(a.value[i.value],!1),i.value=V>=f-1?f-2:V}else l.key==="Backspace"&&!v.value&&(i.value=f-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(i.value<0&&n&&n>0)return;const V=i.value>-1?i.value-1:f-1;if(a.value[V])i.value=V;else{const h=((S=v.value)==null?void 0:S.length)??null;i.value=-1,(x=o.value)==null||x.setSelectionRange(h,h)}}else if(l.key==="ArrowRight"){if(i.value<0)return;const V=i.value+1;a.value[V]?i.value=V:(i.value=-1,(r=o.value)==null||r.setSelectionRange(0,0))}else~i.value&&se(l)&&(i.value=-1)}function ke(l){if(ie(o.value,":autofill")||ie(o.value,":-webkit-autofill")){const n=P.value.find(f=>f.title===l.target.value);n&&R(n)}}function Fe(){var l;e.eager&&((l=b.value)==null||l.calculateVisibleItems())}function Se(){var l;g.value&&(y.value=!0,(l=o.value)==null||l.focus())}function be(l){g.value=!0,setTimeout(()=>{A.value=!0})}function we(l){A.value=!1}function xe(l){(l==null||l===""&&!e.multiple&&!O.value)&&(a.value=[])}const J=L(!1);function R(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const f=a.value.findIndex(d=>(e.valueComparator||We)(d.value,l.value)),s=n??!~f;if(~f){const d=s?[...a.value,l]:[...a.value];d.splice(f,1),a.value=d}else s&&(a.value=[...a.value,l]);e.clearOnSelect&&(v.value="")}else{const f=n!==!1;a.value=f?[l]:[],v.value=f&&!O.value?l.title:"",ue(()=>{m.value=!1,y.value=!0})}}return $(g,(l,n)=>{var f;l!==n&&(l?(J.value=!0,v.value=e.multiple||O.value?"":String(((f=a.value.at(-1))==null?void 0:f.props.title)??""),y.value=!0,ue(()=>J.value=!1)):(!e.multiple&&v.value==null&&(a.value=[]),m.value=!1,(e.multiple||O.value)&&(v.value=""),i.value=-1))}),$(v,l=>{!g.value||J.value||(l&&(m.value=!0),y.value=!l)}),$(m,()=>{if(!e.hideSelected&&m.value&&a.value.length){const l=I.value.findIndex(n=>a.value.some(f=>n.value===f.value));Ne&&window.requestAnimationFrame(()=>{var n;l>=0&&((n=b.value)==null||n.scrollToIndex(l))})}}),$(()=>e.items,(l,n)=>{m.value||g.value&&!n.length&&l.length&&(m.value=!0)}),Be(()=>{const l=!!(!e.hideNoData||I.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),n=a.value.length>0,f=oe.filterProps(e);return w(oe,T({ref:o},f,{modelValue:v.value,"onUpdate:modelValue":[s=>v.value=s,xe],focused:g.value,"onUpdate:focused":s=>g.value=s,validationValue:a.externalValue,counterValue:E.value,dirty:n,onChange:ke,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":m.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!O.value,"v-autocomplete--selecting-index":i.value>-1},e.class],style:e.style,readonly:D.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":me,"onMousedown:control":he,onKeydown:Ve}),{...t,default:()=>M(H,null,[w(Qe,T({ref:F,modelValue:m.value,"onUpdate:modelValue":s=>m.value=s,activator:"parent",contentClass:"v-autocomplete__content",disabled:B.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Fe,onAfterLeave:Se},e.menuProps),{default:()=>[l&&w(Ae,T({ref:Y,selected:ve.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:ye,onFocusin:be,onFocusout:we,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},de,e.listProps),{default:()=>{var s,d,S;return[(s=t["prepend-item"])==null?void 0:s.call(t),!I.value.length&&!e.hideNoData&&(((d=t["no-data"])==null?void 0:d.call(t))??w(ne,{key:"no-data",title:c(e.noDataText)},null)),w(Pe,{ref:b,renderless:!0,items:I.value,itemKey:"value"},{default:x=>{var ae;let{item:r,index:V,itemRef:h}=x;const te=T(r.props,{ref:h,key:r.value,active:X.value&&V===0?!0:void 0,onClick:()=>R(r,null)});return((ae=t.item)==null?void 0:ae.call(t,{item:r,index:V,props:te}))??w(ne,T(te,{role:"option"}),{prepend:j=>{let{isSelected:Ce}=j;return M(H,null,[e.multiple&&!e.hideSelected?w(De,{key:r.value,modelValue:Ce,ripple:!1,tabindex:"-1"},null):void 0,r.props.prependAvatar&&w(Ze,{image:r.props.prependAvatar},null),r.props.prependIcon&&w(re,{icon:r.props.prependIcon},null)])},title:()=>{var j;return y.value?r.title:al("v-autocomplete",r.title,(j=fe(r))==null?void 0:j.title)}})}}),(S=t["append-item"])==null?void 0:S.call(t)]}})]}),a.value.map((s,d)=>{function S(h){h.stopPropagation(),h.preventDefault(),R(s,!1)}const x={"onClick:close":S,onKeydown(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),h.stopPropagation(),S(h))},onMousedown(h){h.preventDefault(),h.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},r=N.value?!!t.chip:!!t.selection,V=r?Xe(N.value?t.chip({item:s,index:d,props:x}):t.selection({item:s,index:d})):void 0;if(!(r&&!V))return M("div",{key:s.value,class:W(["v-autocomplete__selection",d===i.value&&["v-autocomplete__selection--selected",K.value]]),style:Ge(d===i.value?_.value:{})},[N.value?t.chip?w(Ye,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:s.title}}},{default:()=>[V]}):w(Ke,T({key:"chip",closable:e.closableChips,size:"small",text:s.title,disabled:s.props.disabled},x),null):V??M("span",{class:"v-autocomplete__selection-text"},[s.title,e.multiple&&d<a.value.length-1&&M("span",{class:"v-autocomplete__selection-comma"},[Je(",")])])])})]),"append-inner":function(){var x,r;for(var s=arguments.length,d=new Array(s),S=0;S<s;S++)d[S]=arguments[S];return M(H,null,[(x=t["append-inner"])==null?void 0:x.call(t,...d),e.menuIcon?w(re,{class:"v-autocomplete__menu-icon",color:(r=o.value)==null?void 0:r.fieldIconColor,icon:e.menuIcon,onMousedown:ge,onClick:He,"aria-label":c(le.value),title:c(le.value),tabindex:"-1"},null):void 0])}})}),je({isFocused:g,isPristine:y,menu:m,search:v,filteredItems:Q,select:R},o)}});export{il as V};
