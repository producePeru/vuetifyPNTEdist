import{u as K}from"./usePageMeta-IDpd-5vA.js";import{B as J}from"./Banner-BBrylRwv.js";import{_ as Q}from"./FormComponent-B7zhYdJ-.js";import{u as W}from"./useFormOptions-BD_ZbAMu.js";import{h as u}from"./httpRequest-D3KC4pOG.js";import{r as n,u as X,h,i as Z,j as ee,o as ie,k as te,c as oe,b as C,e as r,w as s,g as x,V as ae,t as de,p as g,f as le,m as re,n as ne,d as ce}from"./index-BJzS_b8J.js";import{d as E}from"./dayjs.min-BaPeHrhp.js";import{V as se}from"./VSnackbar-IJfYsELW.js";import{V as me}from"./VContainer-D24iji-J.js";import{a as ue,V as _e}from"./VRow-Cyy-dYXb.js";import{V as pe}from"./VCard-D9pGvByr.js";import"./mp-D70lmokk.js";import"./customParseFormat-BHeJVP8q.js";import"./es-nefKSrI6.js";import"./VAvatar-BPt1v-mD.js";import"./index-CVjC1otO.js";import"./VDialog-BZ0VrLrP.js";import"./VSelect-fYseWTLJ.js";import"./VList-BR1Kbz0P.js";import"./VForm-CIfOpz7B.js";const fe={class:"mp-form"},be={__name:"MujerProduceFormEdit",emits:["loaded","registered"],setup(V,{emit:_}){const f=_,b=n(null),m=n(!1);X(),n(!1);const p=h({}),k=Z();ee();const y=n(!1),R=n(1),e=h({num_soons:0,obs_ruc:null,obs_dni:null,ruc:null});g("formState",e),g("loadingStates",p),g("loadingSubmit",y);const d=h([{type:"title",label:"Datos de la Empresa",md:12},{type:"search",label:"Número de RUC",model:"ruc",required:!1,max:11,disabled:!1},{type:"text",label:"Razón Social",model:"razonSocial",required:!1,disabled:!0},{type:"select",label:"Sector Económico",model:"economicsector_id",required:!0,options:[],disabled:!1},{type:"select",label:"Rubro",model:"rubro_id",required:!0,options:[],disabled:!1},{type:"select",label:"Actividad Comercial",model:"comercialactivity_id",required:!0,options:[],disabled:!1},{type:"select",label:"Región",model:"city_id",required:!0,options:[],disabled:!1},{type:"select",label:"Provincia",model:"province_id",required:!0,options:[],disabled:!1},{type:"select",label:"Distrito",model:"district_id",required:!0,options:[],disabled:!1},{type:"title",label:"Datos del Participante",md:12},{type:"select",label:"Tipo de documento",model:"typedocument_id",required:!0,options:[]},{type:"search",label:"Número de Documento",model:"documentnumber",required:!0,max:8,disabled:!1},{type:"text",label:"Apellido Paterno",model:"lastname",required:!0,disabled:!0},{type:"text",label:"Apellido Materno",model:"middlename",required:!0,disabled:!0},{type:"text",label:"Nombres",model:"name",required:!0,disabled:!0},{type:"select",label:"País de nacimiento",model:"country_id",required:!0,options:[]},{type:"date",label:"Fecha de nacimiento",model:"birthday",required:!0},{type:"select",label:"Género",model:"gender_id",required:!0,options:[]},{type:"select",label:"¿Tiene alguna discapacidad?",model:"sick",required:!0,options:[{label:"SI",value:"si"},{label:"NO",value:"no"}]},{type:"select",label:"Nivel educativo",model:"academicdegree_id",required:!0,options:[]},{type:"select",label:"Estado civil",model:"civil_status_id",required:!0,options:[]},{type:"number",label:"Cantidad de hijos",model:"num_soons",required:!0,max:3,minLength:0},{type:"number",label:"Número de celular",model:"phone",required:!0,max:9,minLength:9},{type:"email",label:"Correo electrónico",model:"email",required:!0},{type:"select",label:"Cargo en la empresa",model:"role_company_id",required:!0,options:[]}]),N=t=>{const i=d.find(o=>o.model===t);R.value==1&&t=="ruc"&&(i.disabled=!i.disabled,D()),t=="documentnumber"&&S()},D=()=>{e.ruc=null,e.razonSocial=null,e.economicsector_id=null,e.rubro_id=null,e.comercialactivity_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.obs_ruc=null},S=()=>{e.typedocument_id=null,e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.birthday=null,e.gender_id=null,e.sick=null,e.academicdegree_id=null,e.civil_status_id=null,e.num_soons=0,e.role_company_id=null,e.obs_dni=null,e.phone=null,e.email=null},$=async(t,i)=>{if(t.model=="rubro_id"){e.comercialactivity_id=null;const o=await u({url:`select/activity-by-rubro/${t.value}`,method:"GET"}),a=d.find(l=>l.model==="comercialactivity_id");a.options=o.data}if(t.model=="city_id"){e.province_id=null,e.district_id=null;const o=`select/provinces/${t.value}`;c(o,"province_id")}if(t.model=="province_id"){e.district_id=null;const o=`select/districts/${t.value}`;c(o,"district_id")}if(t.model==="typedocument_id"){const o=d.find(v=>v.model==="documentnumber");if(!o)return;const a={1:{max:8,autolockNames:!0},2:{max:9,autolockNames:!1},3:{max:12,autolockNames:!1},default:{max:9,autolockNames:!1}},l=a[t.value]||a.default;o.max=l.max,t.value&&S(),["name","lastname","middlename"].forEach(v=>{const q=d.find(H=>H.model===v);q&&(q.disabled=l.autolockNames)}),o.disabled=!1}if(t.model==="documentnumber"){const o=d.find(a=>a.model==="documentnumber");o&&(o.disabled=!1)}},T=async t=>{if(t=="ruc")return P();if(t=="documentnumber")return A()},P=async()=>{try{const t=await u({url:`mp/ruc-number/${e.ruc}`,method:"POST"});if(t.status==409&&["razonSocial"].forEach(i=>{const o=d.find(a=>a.model===i);o&&(o.disabled=!1),e.obs_ruc=1}),t.status==200){const{data:i}=t;e.razonSocial=i.social_reason,e.economicsector_id=i.economic_sector_id,e.rubro_id=i.rubro_id,await c(`select/activity-by-rubro/${i.rubro_id}`,"comercialactivity_id"),e.comercialactivity_id=i.comercial_activity_id,e.city_id=i.city_id,await c(`select/provinces/${i.city_id}`,"province_id"),e.province_id=i.province_id,await c(`select/districts/${i.province_id}`,"district_id"),e.district_id=i.district_id}p.ruc=!1}catch(t){console.log("Error: ",t)}},A=async()=>{try{const t=await u({url:`mp/dni-number/${e.documentnumber}`,method:"POST"});if(t.status==409&&["documentnumber","name","lastname","middlename"].forEach(i=>{const o=d.find(a=>a.model===i);o&&(o.disabled=!1),e.obs_dni=1}),t.status==201){const{data:i}=t;e.lastname=i.last_name,e.middlename=i.middle_name,e.name=i.names}if(t.status==200){const{data:i}=t;e.name=i.names,e.lastname=i.last_name,e.middlename=i.middle_name,e.gender_id=i.gender_id,e.sick=i.sick,e.academicdegree_id=i.academicdegree_id,e.civil_status_id=i.civil_status_id,e.num_soons=i.num_soons,e.birthday=E(i.date_of_birth).format("DD/MM/YYYY"),e.phone=i.phone,e.email=i.email,e.role_company_id=i.role_company_id,e.country_id=i.country_id}p.documentnumber=!1}catch(t){console.log("Error: ",t)}},z=async()=>{y.value=!0;const t={ruc:e.ruc,social_reason:e.razonSocial,economic_sector_id:e.economicsector_id,rubro_id:e.rubro_id,comercial_activity_id:e.comercialactivity_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,t_doc_id:e.typedocument_id,doc_number:e.documentnumber,country_id:e.country_id,date_of_birth:e.birthday,names:e.name,last_name:e.lastname,middle_name:e.middlename,civil_status_id:e.civil_status_id,num_soons:e.num_soons,gender_id:e.gender_id,sick:e.sick,academicdegree_id:e.academicdegree_id,phone:e.phone,email:e.email,role_company_id:e.role_company_id};try{const i=await u({url:`mp/update-participant/${e.id}`,method:"PUT",data:t});i.status==200&&(m.value=!0,b.value=i.message,setTimeout(()=>{window.close()},2e3))}catch(i){console.log("Error: ",i)}finally{y.value=!1}},w=t=>{Array.isArray(d)&&["razonSocial","lastname","middlename","name"].forEach(i=>{const o=d.find(a=>a.model===i);o&&(o.disabled=t)})},c=async(t,i)=>{try{const o=await u({url:t,method:"GET"}),a=d.find(l=>l.model===i);a&&o.data&&(a.options=o.data)}catch(o){console.error("Error de red:",o)}},j=async t=>{const i=await u({url:`select/activity-by-rubro/${t}`,method:"GET"}),o=d.find(a=>a.model==="comercialactivity_id");o.options=i.data},{loadSectorEconomico:M,loadRubros:F,loadCountries:Y,loadCity:B,loadTypeDocuments:O,loadGenders:G,loadCivilStatus:U,loadAcademicDegree:L,loadRoleCompany:I}=W(d);return ie(async()=>{await M(),await F(),await B(),await O(),await G(),await U(),await Y(),await L(),await I(),e.country_id=155}),te(()=>k.query,t=>{if(Object.keys(t).length){e.id=t.participant_id;const i={},o=["ruc","dni","phone"];Object.entries(t).forEach(([a,l])=>{l==="null"?i[a]=null:!o.includes(a)&&l!==""&&!isNaN(l)?i[a]=Number(l):i[a]=l}),e.ruc=i.ruc,e.razonSocial=i.socialReason,e.economicsector_id=i.economic_sector_id,e.rubro_id=i.rubro_id,j(i.rubro_id),e.comercialactivity_id=i.comercial_activity_id,e.city_id=i.city_id,c(`select/provinces/${i.city_id}`,"province_id"),e.province_id=i.province_id,c(`select/districts/${i.province_id}`,"district_id"),e.district_id=i.district_id,e.typedocument_id=i.t_doc_id,e.documentnumber=i.dni,e.lastname=i.last_name,e.middlename=i.middle_name,e.name=i.name,e.country_id=i.country_id,e.gender_id=i.gender_id,e.sick=i.sick,e.academicdegree_id=i.academicdegree_id,e.civil_status_id=i.civil_status_id,e.num_soons=i.numSoons,e.phone=i.phone,e.email=i.email,e.birthday=E(i.date_of_birth).format("DD/MM/YYYY"),e.role_company_id=i.role_company_id,setTimeout(()=>{f("loaded",!0)},2500),w(!1)}else w(!0)},{immediate:!0}),(t,i)=>(C(),oe("div",fe,[r(Q,{colorForm:"#7d4fc6",fields:d,onSearchDataApi:T,onSubmit:z,nameBtnSend:"GUARDAR",onChange:$,onHandleClearSearch:N},null,8,["fields"]),r(se,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=o=>m.value=o),location:"top right",color:"success",timeout:"3000",elevation:"6"},{default:s(()=>[r(ae,{start:""},{default:s(()=>i[1]||(i[1]=[x("mdi-check-circle")])),_:1,__:[1]}),x(" "+de(b.value),1)]),_:1},8,["modelValue"])]))}},ye={class:"mp"},Me={__name:"index",setup(V){K("Mujer Produce","Registro de Participante","mp-ico.ico"),n(!0);const _=n(!0),f=n({title:"Registro de Participante"});return(b,m)=>(C(),le(me,{class:"py-0",fluid:""},{default:s(()=>[r(ue,{align:"center",justify:"center"},{default:s(()=>[r(_e,{cols:"12",sm:"12",md:"10",lg:"8",xl:"6",class:"my-2"},{default:s(()=>[r(re,{"model-value":_.value,class:"align-center justify-center",persistent:"",scrim:""},{default:s(()=>[r(ne,{color:"#7d4fc6",size:"64",indeterminate:""})]),_:1},8,["model-value"]),r(pe,{elevation:"8",rounded:"lg"},{default:s(()=>[r(J,{detailEvent:f.value},null,8,["detailEvent"]),ce("div",ye,[r(be,{onLoaded:m[0]||(m[0]=p=>_.value=!1)})])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Me as default};
