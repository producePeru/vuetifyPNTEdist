import{u as Me,c as Ae,d as De,e as Pe,f as re,g as Ke,b as _e,h as Re,i as Le,j as Oe}from"./VSelect-DW8r69Br.js";import{R as ve,s as O,j as x,E as U,am as Ee,aU as ee,aV as Te,b as C,O as H,F as W,S as Be,a3 as je,r as $,a2 as Ne,T as J,aB as Ue,m as z,K as ie,au as $e,ap as ze,D as oe,a as b,G as K,aq as He,aW as We,aD as Ge,aE as Qe,aX as se,aY as ce,aZ as Xe,V as fe,a_ as Ye,a$ as Ze,b0 as Je,n as qe,a5 as el,e as ll}from"./index-DMNK5NcI.js";import{a as tl}from"./VAvatar-Yboe_B8k.js";const al=(e,u,t)=>{if(e==null||u==null)return-1;if(!u.length)return 0;e=e.toString().toLocaleLowerCase(),u=u.toString().toLocaleLowerCase();const f=[];let r=e.indexOf(u);for(;~r;)f.push([r,r+u.length]),r=e.indexOf(u,r+u.length);return f.length?f:-1};function q(e,u){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+u.length]]:Array.isArray(e[0])?e:[e]}const nl=ve({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ul(e,u,t){var A;const f=[],r=(t==null?void 0:t.default)??al,y=t!=null&&t.filterKeys?ee(t.filterKeys):!1,V=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return f;e:for(let F=0;F<e.length;F++){const[k,s=k]=ee(e[F]),D={},I={};let p=-1;if((u||V>0)&&!(t!=null&&t.noFilter)){if(typeof k=="object"){if(k.type==="divider"||k.type==="subheader")continue;const d=y||Object.keys(s);for(const a of d){const T=Te(s,a),P=(A=t==null?void 0:t.customKeyFilter)==null?void 0:A[a];if(p=P?P(T,u,k):r(T,u,k),p!==-1&&p!==!1)P?D[a]=q(p,u):I[a]=q(p,u);else if((t==null?void 0:t.filterMode)==="every")continue e}}else p=r(k,u,k),p!==-1&&p!==!1&&(I.title=q(p,u));const _=Object.keys(I).length,R=Object.keys(D).length;if(!_&&!R||(t==null?void 0:t.filterMode)==="union"&&R!==V&&!_||(t==null?void 0:t.filterMode)==="intersection"&&(R!==V||!_))continue}f.push({index:F,matches:{...I,...D}})}return f}function rl(e,u,t,f){const r=O([]),y=O(new Map),V=x(()=>U(u));Ee(()=>{const F=typeof t=="function"?t():U(t),k=typeof F!="string"&&typeof F!="number"?"":String(F),s=ul(V.value,k,{customKeyFilter:{...e.customKeyFilter,...U(f==null?void 0:f.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),D=U(u),I=[],p=new Map;s.forEach(_=>{let{index:R,matches:d}=_;const a=D[R];I.push(a),p.set(a.value,d)}),r.value=I,y.value=p});function A(F){return y.value.get(F.value)}return{filteredItems:r,filteredMatches:y,getMatches:A}}function il(e,u,t){return t==null||!t.length?u:t.map((f,r)=>{const y=r===0?0:t[r-1][1],V=[C("span",{class:H(`${e}__unmask`)},[u.slice(y,f[0])]),C("span",{class:H(`${e}__mask`)},[u.slice(f[0],f[1])])];return r===t.length-1&&V.push(C("span",{class:H(`${e}__unmask`)},[u.slice(f[1])])),C(W,null,[V])})}const ol=ve({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...nl({filterKeys:["title"]}),...De(),...Ge(Qe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...We({transition:!1})},"VAutocomplete"),vl=Be()({name:"VAutocomplete",props:ol(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,u){let{slots:t}=u;const{t:f}=je(),r=$(),y=O(!1),V=O(!0),A=O(!1),F=$(),k=$(),s=O(-1),{items:D,transformIn:I,transformOut:p}=Me(e),{textColorClasses:_,textColorStyles:R}=Ne(()=>{var l;return(l=r.value)==null?void 0:l.color}),d=J(e,"search",""),a=J(e,"modelValue",[],l=>I(l===null?[null]:ee(l)),l=>{const n=p(l);return e.multiple?n:n[0]??null}),T=x(()=>typeof e.counterValue=="function"?e.counterValue(a.value):typeof e.counterValue=="number"?e.counterValue:a.value.length),P=Ue(e),{filteredItems:G,getMatches:de}=rl(e,D,()=>V.value?"":d.value),M=x(()=>e.hideSelected?G.value.filter(l=>!a.value.some(n=>n.value===l.value)):G.value),B=x(()=>!!(e.chips||t.chip)),E=x(()=>B.value||!!t.selection),me=x(()=>a.value.map(l=>l.props.value)),Q=x(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&d.value===((n=M.value[0])==null?void 0:n.title))&&M.value.length>0&&!V.value&&!A.value}),j=x(()=>e.hideNoData&&!M.value.length||P.isReadonly.value||P.isDisabled.value),X=J(e,"menu"),h=x({get:()=>X.value,set:l=>{var n;X.value&&!l&&((n=F.value)!=null&&n.Î¨openChildren.size)||l&&j.value||(X.value=l)}}),le=x(()=>h.value?e.closeText:e.openText),Y=$(),he=Ae(Y,r);function ge(l){e.openOnClear&&(h.value=!0),d.value=""}function ye(){j.value||(h.value=!0)}function Ve(l){j.value||(y.value&&(l.preventDefault(),l.stopPropagation()),h.value=!h.value)}function ke(l){var n;(se(l)||l.key==="Backspace")&&((n=r.value)==null||n.focus())}function pe(l){var i,m,S,w,o;if(P.isReadonly.value)return;const n=(i=r.value)==null?void 0:i.selectionStart,v=a.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(h.value=!0),["Escape"].includes(l.key)&&(h.value=!1),Q.value&&["Enter","Tab"].includes(l.key)&&!a.value.some(c=>{let{value:g}=c;return g===M.value[0].value})&&L(M.value[0]),l.key==="ArrowDown"&&Q.value&&((m=Y.value)==null||m.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&E.value&&a.value.length>0&&!d.value)return L(a.value[0],!1);if(~s.value){l.preventDefault();const c=s.value;L(a.value[s.value],!1),s.value=c>=v-1?v-2:c}else l.key==="Backspace"&&!d.value&&(s.value=v-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(s.value<0&&n&&n>0)return;const c=s.value>-1?s.value-1:v-1;if(a.value[c])s.value=c;else{const g=((S=d.value)==null?void 0:S.length)??null;s.value=-1,(w=r.value)==null||w.setSelectionRange(g,g)}}else if(l.key==="ArrowRight"){if(s.value<0)return;const c=s.value+1;a.value[c]?s.value=c:(s.value=-1,(o=r.value)==null||o.setSelectionRange(0,0))}else~s.value&&se(l)&&(s.value=-1)}function be(l){if(ce(r.value,":autofill")||ce(r.value,":-webkit-autofill")){const n=D.value.find(v=>v.title===l.target.value);n&&L(n)}}function Fe(){var l;e.eager&&((l=k.value)==null||l.calculateVisibleItems())}function Se(){var l;y.value&&(V.value=!0,(l=r.value)==null||l.focus())}function we(l){y.value=!0,setTimeout(()=>{A.value=!0})}function xe(l){A.value=!1}function Ce(l){(l==null||l===""&&!e.multiple&&!E.value)&&(a.value=[])}const Z=O(!1);function L(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const v=a.value.findIndex(m=>(e.valueComparator||Xe)(m.value,l.value)),i=n??!~v;if(~v){const m=i?[...a.value,l]:[...a.value];m.splice(v,1),a.value=m}else i&&(a.value=[...a.value,l]);e.clearOnSelect&&(d.value="")}else{const v=n!==!1;a.value=v?[l]:[],d.value=v&&!E.value?l.title:"",ie(()=>{h.value=!1,V.value=!0})}}return z(y,(l,n)=>{var v;l!==n&&(l?(Z.value=!0,d.value=e.multiple||E.value?"":String(((v=a.value.at(-1))==null?void 0:v.props.title)??""),V.value=!0,ie(()=>Z.value=!1)):(!e.multiple&&d.value==null&&(a.value=[]),h.value=!1,(e.multiple||E.value)&&(d.value=""),s.value=-1))}),z(d,l=>{!y.value||Z.value||(l&&(h.value=!0),V.value=!l)}),z(h,()=>{if(!e.hideSelected&&h.value&&a.value.length){const l=M.value.findIndex(n=>a.value.some(v=>n.value===v.value));$e&&window.requestAnimationFrame(()=>{var n;l>=0&&((n=k.value)==null||n.scrollToIndex(l))})}}),z(()=>e.items,(l,n)=>{h.value||y.value&&!n.length&&l.length&&(h.value=!0)}),ze(()=>{const l=!!(!e.hideNoData||M.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),n=a.value.length>0,v=oe.filterProps(e);return b(oe,K({ref:r},v,{modelValue:d.value,"onUpdate:modelValue":[i=>d.value=i,Ce],focused:y.value,"onUpdate:focused":i=>y.value=i,validationValue:a.externalValue,counterValue:T.value,dirty:n,onChange:be,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":h.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!E.value,"v-autocomplete--selecting-index":s.value>-1},e.class],style:e.style,readonly:P.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":ge,"onMousedown:control":ye,onKeydown:pe}),{...t,default:()=>C(W,null,[b(Ze,K({ref:F,modelValue:h.value,"onUpdate:modelValue":i=>h.value=i,activator:"parent",contentClass:"v-autocomplete__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Fe,onAfterLeave:Se},e.menuProps),{default:()=>[l&&b(Pe,K({ref:Y,filterable:!0,selected:me.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:i=>i.preventDefault(),onKeydown:ke,onFocusin:we,onFocusout:xe,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},he,e.listProps),{default:()=>{var i,m,S;return[(i=t["prepend-item"])==null?void 0:i.call(t),!M.value.length&&!e.hideNoData&&(((m=t["no-data"])==null?void 0:m.call(t))??b(re,{key:"no-data",title:f(e.noDataText)},null)),b(Ke,{ref:k,renderless:!0,items:M.value,itemKey:"value"},{default:w=>{var ae,ne,ue;let{item:o,index:c,itemRef:g}=w;const te=K(o.props,{ref:g,key:o.value,active:Q.value&&c===0?!0:void 0,onClick:()=>L(o,null)});return o.type==="divider"?((ae=t.divider)==null?void 0:ae.call(t,{props:o.raw,index:c}))??b(_e,K(o.props,{key:`divider-${c}`}),null):o.type==="subheader"?((ne=t.subheader)==null?void 0:ne.call(t,{props:o.raw,index:c}))??b(Re,K(o.props,{key:`subheader-${c}`}),null):((ue=t.item)==null?void 0:ue.call(t,{item:o,index:c,props:te}))??b(re,K(te,{role:"option"}),{prepend:N=>{let{isSelected:Ie}=N;return C(W,null,[e.multiple&&!e.hideSelected?b(Le,{key:o.value,modelValue:Ie,ripple:!1,tabindex:"-1"},null):void 0,o.props.prependAvatar&&b(tl,{image:o.props.prependAvatar},null),o.props.prependIcon&&b(fe,{icon:o.props.prependIcon},null)])},title:()=>{var N;return V.value?o.title:il("v-autocomplete",o.title,(N=de(o))==null?void 0:N.title)}})}}),(S=t["append-item"])==null?void 0:S.call(t)]}})]}),a.value.map((i,m)=>{function S(g){g.stopPropagation(),g.preventDefault(),L(i,!1)}const w={"onClick:close":S,onKeydown(g){g.key!=="Enter"&&g.key!==" "||(g.preventDefault(),g.stopPropagation(),S(g))},onMousedown(g){g.preventDefault(),g.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},o=B.value?!!t.chip:!!t.selection,c=o?Je(B.value?t.chip({item:i,index:m,props:w}):t.selection({item:i,index:m})):void 0;if(!(o&&!c))return C("div",{key:i.value,class:H(["v-autocomplete__selection",m===s.value&&["v-autocomplete__selection--selected",_.value]]),style:qe(m===s.value?R.value:{})},[B.value?t.chip?b(el,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:i.title}}},{default:()=>[c]}):b(Oe,K({key:"chip",closable:e.closableChips,size:"small",text:i.title,disabled:i.props.disabled},w),null):c??C("span",{class:"v-autocomplete__selection-text"},[i.title,e.multiple&&m<a.value.length-1&&C("span",{class:"v-autocomplete__selection-comma"},[ll(",")])])])})]),"append-inner":function(){var w,o;for(var i=arguments.length,m=new Array(i),S=0;S<i;S++)m[S]=arguments[S];return C(W,null,[(w=t["append-inner"])==null?void 0:w.call(t,...m),e.menuIcon?b(fe,{class:"v-autocomplete__menu-icon",color:(o=r.value)==null?void 0:o.fieldIconColor,icon:e.menuIcon,onMousedown:Ve,onClick:Ye,"aria-label":f(le.value),title:f(le.value),tabindex:"-1"},null):void 0])}})}),He({isFocused:y,isPristine:V,menu:h,search:d,filteredItems:G,select:L},r)}});export{vl as V};
