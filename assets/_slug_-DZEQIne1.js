import{u as ae}from"./usePageMeta-BbkE-PbQ.js";import{d as V}from"./VDialog-vWHRxBrv.js";import{c as oe}from"./customParseFormat-wFg-DbiP.js";import"./es-CyoZuFcs.js";import{_ as le,c as T,b as x,e as d,w as c,d as f,t as g,g as v,V as k,r as u,u as de,h as C,i as z,j as re,o as P,k as se,p as R,f as A,l as ne,m as ce,n as me}from"./index-qAjgb79x.js";import{V as F,a as O}from"./VRow-BJq6fa_x.js";import{_ as ue}from"./FormComponent-BG_rvnIi.js";import{u as _e}from"./useFormOptions-BD_ZbAMu.js";import{h as y}from"./httpRequest-D3KC4pOG.js";import{V as pe}from"./VSnackbar-DZNTz0Y6.js";import{V as fe}from"./VContainer-ClqT3OFD.js";import{V as ye}from"./VCard-B5tV9PZZ.js";import"./index-WtgcJpDA.js";import"./VForm-C-xDy1Ov.js";import"./VList-D1tOb-aP.js";import"./VAvatar-NWPXQnZf.js";const be={class:"mp-header mp"},ve={style:{"line-height":"2.2",color:"#fff",position:"relative","z-index":"2"}},he={class:"mp-title"},ge={style:{"list-style":"none","padding-left":"0","font-size":"18px"}},Se={class:"mp-list"},Ee={class:"mp-list"},xe={__name:"ActividadesUgo",props:{detailEvent:{type:Object,default:()=>({})}},setup(b){return V.extend(oe),(_,n)=>(x(),T("div",be,[d(O,null,{default:c(()=>[d(F,null,{default:c(()=>[f("div",ve,[f("h1",he,g(b.detailEvent.title),1),f("ul",ge,[f("li",Se,[d(k,null,{default:c(()=>n[0]||(n[0]=[v("mdi-tag")])),_:1,__:[0]}),v(" TEMA: "+g(b.detailEvent.theme),1)]),f("li",Ee,[d(k,{left:""},{default:c(()=>n[1]||(n[1]=[v("mdi-calendar")])),_:1,__:[1]}),v(" FECHA: "+g(b.detailEvent.startDate)+" - "+g(b.detailEvent.endDate),1)]),n[2]||(n[2]=f("li",{class:"mp-list"},null,-1))])])]),_:1})]),_:1})]))}},we=le(xe,[["__scopeId","data-v-cc953b9b"]]),Ne={class:"mp-form"},Ce={__name:"FormAsistenciaUgo",emits:["loaded","registered"],setup(b,{emit:_}){const n=_,S=u(null),h=u(!1);de(),u(!1);const m=C({}),r=z();re();const E=u(!1),M=u(1),e=C({num_soons:0,obs_ruc:null,obs_dni:null,ruc:null});R("formState",e),R("loadingStates",m),R("loadingSubmit",E);const l=C([{type:"title",label:"Datos de la Empresa",md:12},{type:"search",label:"Número de RUC",model:"ruc",required:!1,max:11,disabled:!1},{type:"text",label:"Razón Social",model:"razonSocial",required:!1,disabled:!1},{type:"text",label:"Nombre Comercial (marca)",model:"comercialName",required:!1},{type:"select",label:"Sector Económico",model:"economicsector_id",required:!0,options:[],disabled:!1},{type:"select",label:"Rubro",model:"rubro_id",required:!0,options:[],disabled:!1},{type:"select",label:"Actividad Comercial",model:"comercialactivity_id",required:!1,options:[],disabled:!1},{type:"select",label:"Región",model:"city_id",required:!0,options:[],disabled:!1},{type:"select",label:"Provincia",model:"province_id",required:!0,options:[],disabled:!1},{type:"select",label:"Distrito",model:"district_id",required:!0,options:[],disabled:!1},{type:"title",label:"Datos del Participante",md:12},{type:"select",label:"Tipo de documento",model:"typedocument_id",required:!0,options:[]},{type:"search",label:"Número de Documento",model:"documentnumber",required:!0,max:8,disabled:!1},{type:"text",label:"Apellido Paterno",model:"lastname",required:!0,disabled:!0},{type:"text",label:"Apellido Materno",model:"middlename",required:!0,disabled:!0},{type:"text",label:"Nombres",model:"name",required:!0,disabled:!0},{type:"select",label:"Género",model:"gender_id",required:!0,options:[]},{type:"select",label:"¿Tiene alguna discapacidad?",model:"sick",required:!0,options:[{label:"SI",value:"si"},{label:"NO",value:"no"}]},{type:"email",label:"Correo electrónico",model:"email",required:!0},{type:"number",label:"Número de celular",model:"phone",required:!0,max:9,minLength:9},{type:"select",label:"País de nacimiento",model:"country_id",required:!0,options:[]}]),Y=i=>{const t=l.find(a=>a.model===i);M.value==1&&i=="ruc"&&(t.disabled=!t.disabled,q()),i=="documentnumber"&&w()},q=()=>{e.ruc=null,e.razonSocial=null,e.comercialName=null,e.economicsector_id=null,e.rubro_id=null,e.comercialactivity_id=null,e.city_id=null,e.province_id=null,e.district_id=null},w=()=>{e.typedocument_id=null,e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.gender_id=null,e.sick=null,e.phone=null,e.email=null,e.country_id=null},j=async(i,t)=>{if(i.model=="rubro_id"){e.comercialactivity_id=null;const a=await y({url:`select/activity-by-rubro/${i.value}`,method:"GET"}),o=l.find(s=>s.model==="comercialactivity_id");o.options=a.data}if(i.model=="city_id"){e.province_id=null,e.district_id=null;const a=`select/provinces/${i.value}`;p(a,"province_id")}if(i.model=="province_id"){e.district_id=null;const a=`select/districts/${i.value}`;p(a,"district_id")}if(i.model==="typedocument_id"){const a=l.find(N=>N.model==="documentnumber");if(!a)return;const o={1:{max:8,autolockNames:!0},2:{max:9,autolockNames:!1},3:{max:12,autolockNames:!1},default:{max:9,autolockNames:!1}},s=o[i.value]||o.default;a.max=s.max,i.value&&w(),["name","lastname","middlename"].forEach(N=>{const $=l.find(ie=>ie.model===N);$&&($.disabled=s.autolockNames)}),a.disabled=!1}if(i.model==="documentnumber"){const a=l.find(o=>o.model==="documentnumber");a&&(a.disabled=!1)}},G=async i=>{if(i=="ruc")return B();if(i=="documentnumber")return U()},B=async()=>{try{const i=await y({url:`mp/ruc-number/${e.ruc}`,method:"POST"});if(i.status==409&&["razonSocial"].forEach(t=>{const a=l.find(o=>o.model===t);a&&(a.disabled=!1),e.obs_ruc=1}),i.status==200){const{data:t}=i;e.razonSocial=t.social_reason,e.economicsector_id=t.economic_sector_id,e.rubro_id=t.rubro_id,await p(`select/activity-by-rubro/${t.rubro_id}`,"comercialactivity_id"),e.comercialactivity_id=t.comercial_activity_id,e.city_id=t.city_id,await p(`select/provinces/${t.city_id}`,"province_id"),e.province_id=t.province_id,await p(`select/districts/${t.province_id}`,"district_id"),e.district_id=t.district_id}m.ruc=!1}catch(i){console.log("Error: ",i)}},U=async()=>{try{const i=await y({url:`mp/dni-number/${e.documentnumber}`,method:"POST"});if(i.status==409&&["documentnumber","name","lastname","middlename"].forEach(t=>{const a=l.find(o=>o.model===t);a&&(a.disabled=!1),e.obs_dni=1}),i.status==201){const{data:t}=i;e.lastname=t.last_name,e.middlename=t.middle_name,e.name=t.names}if(i.status==200){const{data:t}=i;e.name=t.names,e.lastname=t.last_name,e.middlename=t.middle_name,e.gender_id=t.gender_id,e.sick=t.sick,e.academicdegree_id=t.academicdegree_id,e.civil_status_id=t.civil_status_id,e.num_soons=t.num_soons,e.birthday=V(t.date_of_birth).format("DD/MM/YYYY"),e.phone=t.phone,e.email=t.email,e.role_company_id=t.role_company_id,e.country_id=t.country_id}m.documentnumber=!1}catch(i){console.log("Error: ",i)}},I=async()=>{E.value=!0;const i={slug:r.params.slug,ruc:e.ruc,socialReason:e.razonSocial,comercialName:e.comercialName,economicsector_id:e.economicsector_id,category_id:e.rubro_id,comercialactivity_id:e.comercialactivity_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,lastname:e.lastname,middlename:e.middlename,name:e.name,gender_id:e.gender_id,sick:e.sick,email:e.email,phone:e.phone,country_id:e.country_id};try{const t=await y({url:"public/attendance-present",method:"POST",data:i});t.status==200&&(h.value=!0,S.value=t.message,q(),w())}catch(t){console.log("Error: ",t)}finally{E.value=!1}},D=i=>{Array.isArray(l)&&["razonSocial","lastname","middlename","name"].forEach(t=>{const a=l.find(o=>o.model===t);a&&(a.disabled=i)})},p=async(i,t)=>{try{const a=await y({url:i,method:"GET"}),o=l.find(s=>s.model===t);o&&a.data&&(o.options=a.data)}catch(a){console.error("Error de red:",a)}},H=async i=>{const t=await y({url:`select/activity-by-rubro/${i}`,method:"GET"}),a=l.find(o=>o.model==="comercialactivity_id");a.options=t.data},{loadSectorEconomico:L,loadRubros:K,loadCountries:J,loadCity:Q,loadTypeDocuments:W,loadGenders:X,loadCivilStatus:Z,loadAcademicDegree:ee,loadRoleCompany:te}=_e(l);return P(async()=>{await L(),await K(),await Q(),await W(),await X(),await Z(),await J(),await ee(),await te(),e.country_id=155}),se(()=>r.query,i=>{if(Object.keys(i).length){e.id=i.participant_id;const t={},a=["ruc","dni","phone"];Object.entries(i).forEach(([o,s])=>{s==="null"?t[o]=null:!a.includes(o)&&s!==""&&!isNaN(s)?t[o]=Number(s):t[o]=s}),e.ruc=t.ruc,e.razonSocial=t.socialReason,e.economicsector_id=t.economic_sector_id,e.rubro_id=t.rubro_id,H(t.rubro_id),e.comercialactivity_id=t.comercial_activity_id,e.city_id=t.city_id,p(`select/provinces/${t.city_id}`,"province_id"),e.province_id=t.province_id,p(`select/districts/${t.province_id}`,"district_id"),e.district_id=t.district_id,e.typedocument_id=t.t_doc_id,e.documentnumber=t.dni,e.lastname=t.last_name,e.middlename=t.middle_name,e.name=t.name,e.country_id=t.country_id,e.gender_id=t.gender_id,e.sick=t.sick,e.academicdegree_id=t.academicdegree_id,e.civil_status_id=t.civil_status_id,e.num_soons=t.numSoons,e.phone=t.phone,e.email=t.email,e.birthday=V(t.date_of_birth).format("DD/MM/YYYY"),e.role_company_id=t.role_company_id,setTimeout(()=>{n("loaded",!0)},2500),D(!1)}else D(!0)},{immediate:!0}),(i,t)=>(x(),T("div",Ne,[d(ue,{colorForm:"#0f7eb3",fields:l,onSearchDataApi:G,onSubmit:I,nameBtnSend:"REGISTRAR",onChange:j,onHandleClearSearch:Y},null,8,["fields"]),d(pe,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),location:"top right",color:"success",timeout:"3000",elevation:"6"},{default:c(()=>[d(k,{start:""},{default:c(()=>t[1]||(t[1]=[v("mdi-check-circle")])),_:1,__:[1]}),v(" "+g(S.value),1)]),_:1},8,["modelValue"])]))}},Re={class:"mp"},Ue={__name:"[slug]",setup(b){ae("Registro de actividades","Registro de actividades","pp.ico"),u(!0);const _=u(!0),n=u({}),S=z(),h=async()=>{try{const m=S.params.slug,r=await y({url:`public/data-attendance/${m}`,method:"GET"});console.log("response",r),r.status===200&&(n.value=(r==null?void 0:r.data)||{}),console.log("response",r)}catch(m){console.error("Error de red:",m)}finally{_.value=!1}};return P(async()=>{await h()}),(m,r)=>(x(),A(fe,{class:"py-0",fluid:""},{default:c(()=>[d(O,{align:"center",justify:"center"},{default:c(()=>[d(F,{cols:"12",sm:"12",md:"10",lg:"8",xl:"6",class:"my-2"},{default:c(()=>[d(ce,{"model-value":_.value,class:"align-center justify-center",persistent:"",scrim:""},{default:c(()=>[d(me,{color:"#0f7eb3",size:"64",indeterminate:""})]),_:1},8,["model-value"]),_.value?ne("",!0):(x(),A(ye,{key:0,elevation:"8",rounded:"lg"},{default:c(()=>[d(we,{detailEvent:n.value},null,8,["detailEvent"]),f("div",Re,[d(Ce,{onLoaded:r[0]||(r[0]=E=>_.value=!1)})])]),_:1}))]),_:1})]),_:1})]),_:1}))}};export{Ue as default};
