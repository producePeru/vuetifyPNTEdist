import{u as ee}from"./usePageMeta-DgSkwlnp.js";import{h as v}from"./httpRequest-D3KC4pOG.js";import{B as te}from"./Banner-Ci0qu54S.js";import{_ as ae}from"./FormComponent-kdSwMKLB.js";import{u as ie}from"./useFormOptions-BD_ZbAMu.js";import{u as oe,r as g,h as V,i as N,j as le,k as re,o as P,c as S,b,e as m,p as C,_ as ne,v as de,d as c,g as p,f as Y,l as M,w as _,B as $,V as se,F as ce,m as me,n as ue}from"./index-CdUwQdOV.js";import{d as h}from"./dayjs.min-BaPeHrhp.js";import{_ as pe}from"./Finalizado-DHY4nPBn.js";import{V as _e}from"./VSnackbar-DKm22VIz.js";import{V as fe}from"./VContainer-DbRY79T4.js";import{a as be,V as ye}from"./VRow-CfpktdI2.js";import{V as ve}from"./VCard-CblntBVB.js";import"./mp-D70lmokk.js";import"./customParseFormat-BHeJVP8q.js";import"./es-nefKSrI6.js";import"./VAvatar-yHTdl7Ia.js";import"./index-b688TP73.js";import"./VAutocomplete-CzxxYRIg.js";import"./VList-dHy-I1ng.js";import"./VDialog-rz9SlHWG.js";import"./VForm-CurYl2Hy.js";const he={class:"mp-form"},ge={__name:"MujerProduceForm",props:{detailEvent:{type:Object,required:!0}},emits:["registered"],setup(x,{emit:u}){const E=u,s=x,y=oe(),o=g(!1),i=V({}),r=N();le();const d=g(!1),D=g(1),e=V({num_soons:0,obs_ruc:null,obs_dni:null,ruc:r.query.ruc||null});C("formState",e),C("loadingStates",i),C("loadingSubmit",d);const f=V([{type:"title",label:"Datos de la Empresa",md:12},{type:"search",label:"Número de RUC",model:"ruc",required:!1,max:11,disabled:!1},{type:"text",label:"Razón Social",model:"razonSocial",required:!1,disabled:!0},{type:"select",label:"Sector Económico",model:"economicsector_id",required:!0,options:[],disabled:!1},{type:"select",label:"Rubro",model:"rubro_id",required:!0,options:[],disabled:!1},{type:"select",label:"Actividad Comercial",model:"comercialactivity_id",required:!0,options:[],disabled:!1},{type:"select",label:"Región",model:"city_id",required:!0,options:[],disabled:!1},{type:"select",label:"Provincia",model:"province_id",required:!0,options:[],disabled:!1},{type:"select",label:"Distrito",model:"district_id",required:!0,options:[],disabled:!1},{type:"title",label:"Datos del Participante",md:12},{type:"select",label:"Tipo de documento",model:"typedocument_id",required:!0,options:[]},{type:"search",label:"Número de Documento",model:"documentnumber",required:!0,max:8,disabled:!1},{type:"text",label:"Apellido Paterno",model:"lastname",required:!0,disabled:!0},{type:"text",label:"Apellido Materno",model:"middlename",required:!0,disabled:!0},{type:"text",label:"Nombres",model:"name",required:!0,disabled:!0},{type:"select",label:"País de nacimiento",model:"country_id",required:!0,options:[]},{type:"date",label:"Fecha de nacimiento",model:"birthday",required:!0},{type:"select",label:"Género",model:"gender_id",required:!0,options:[]},{type:"select",label:"¿Tiene alguna discapacidad?",model:"sick",required:!0,options:[{label:"SI",value:"si"},{label:"NO",value:"no"}]},{type:"select",label:"Nivel educativo",model:"academicdegree_id",required:!0,options:[]},{type:"select",label:"Estado civil",model:"civil_status_id",required:!0,options:[]},{type:"number",label:"Cantidad de hijos",model:"num_soons",required:!0,max:3,minLength:0},{type:"number",label:"Número de celular",model:"phone",required:!0,max:9,minLength:9},{type:"email",label:"Correo electrónico",model:"email",required:!0},{type:"select",label:"Cargo en la empresa",model:"role_company_id",required:!0,options:[]},{type:"checkbox",label:'Autorizo la participación y el uso de mis datos personales e imagen para fines institucionales del Programa Nacional "Tu Empresa", según la Ley N.º 29733',model:"autorization",required:!0,md:12,rows:3}]);re(o,a=>{y.global.name.value=a?"dark":"light"});const z=a=>{const t=f.find(l=>l.model===a);D.value==1&&a=="ruc"&&(t.disabled=!t.disabled,A()),a=="documentnumber"&&T()},A=()=>{e.ruc=null,e.razonSocial=null,e.economicsector_id=null,e.rubro_id=null,e.comercialactivity_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.obs_ruc=null},T=()=>{e.typedocument_id=null,e.documentnumber=null,e.name=null,e.lastname=null,e.middlename=null,e.birthday=null,e.gender_id=null,e.sick=null,e.academicdegree_id=null,e.civil_status_id=null,e.num_soons=0,e.role_company_id=null,e.obs_dni=null,e.phone=null,e.email=null},F=async(a,t)=>{if(a.model=="rubro_id"){e.comercialactivity_id=null;const l=await v({url:`select/activity-by-rubro/${a.value}`,method:"GET"}),n=f.find(k=>k.model==="comercialactivity_id");n.options=l.data}if(a.model=="city_id"){e.province_id=null,e.district_id=null;const l=`select/provinces/${a.value}`;w(l,"province_id")}if(a.model=="province_id"){e.district_id=null;const l=`select/districts/${a.value}`;w(l,"district_id")}if(a.model==="typedocument_id"){const l=f.find(q=>q.model==="documentnumber");if(!l)return;const n={1:{max:8,autolockNames:!0},2:{max:9,autolockNames:!1},3:{max:12,autolockNames:!1},default:{max:9,autolockNames:!1}},k=n[a.value]||n.default;l.max=k.max,a.value&&T(),["name","lastname","middlename"].forEach(q=>{const R=f.find(Q=>Q.model===q);R&&(R.disabled=k.autolockNames)}),l.disabled=!1}if(a.model==="documentnumber"){const l=f.find(n=>n.model==="documentnumber");l&&(l.disabled=!1)}},j=async a=>{if(a=="ruc")return H();if(a=="documentnumber")return I()},H=async()=>{try{const a=await v({url:`mp/ruc-number/${e.ruc}`,method:"POST"});if(a.status==409&&["razonSocial"].forEach(t=>{const l=f.find(n=>n.model===t);l&&(l.disabled=!1),e.obs_ruc=1}),a.status==200){const{data:t}=a;e.razonSocial=t.social_reason,e.economicsector_id=t.economic_sector_id,e.rubro_id=t.rubro_id,await w(`select/activity-by-rubro/${t.rubro_id}`,"comercialactivity_id"),e.comercialactivity_id=t.comercial_activity_id,e.city_id=t.city_id,await w(`select/provinces/${t.city_id}`,"province_id"),e.province_id=t.province_id,await w(`select/districts/${t.province_id}`,"district_id"),e.district_id=t.district_id}i.ruc=!1}catch(a){console.log("Error: ",a)}},I=async()=>{try{const a=await v({url:`mp/dni-number/${e.documentnumber}`,method:"POST"});if(a.status==409&&["documentnumber","name","lastname","middlename"].forEach(t=>{const l=f.find(n=>n.model===t);l&&(l.disabled=!1),e.obs_dni=1}),a.status==201){const{data:t}=a;e.lastname=t.last_name,e.middlename=t.middle_name,e.name=t.names}if(a.status==200){const{data:t}=a;e.name=t.names,e.lastname=t.last_name,e.middlename=t.middle_name,e.gender_id=t.gender_id,e.sick=t.sick,e.academicdegree_id=t.academicdegree_id,e.civil_status_id=t.civil_status_id,e.num_soons=t.num_soons,e.birthday=h(t.date_of_birth).format("DD/MM/YYYY"),e.phone=t.phone,e.email=t.email,e.role_company_id=t.role_company_id,e.country_id=t.country_id}i.documentnumber=!1}catch(a){console.log("Error: ",a)}},O=async()=>{d.value=!0;const a={ruc:e.ruc,social_reason:e.razonSocial,economic_sector_id:e.economicsector_id,rubro_id:e.rubro_id,comercial_activity_id:e.comercialactivity_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,t_doc_id:e.typedocument_id,doc_number:e.documentnumber,country_id:e.country_id,date_of_birth:e.birthday,names:e.name,last_name:e.lastname,middle_name:e.middlename,civil_status_id:e.civil_status_id,num_soons:e.num_soons,gender_id:e.gender_id,sick:e.sick,academicdegree_id:e.academicdegree_id,phone:e.phone,email:e.email,role_company_id:e.role_company_id,obs_ruc:e.obs_ruc,obs_dni:e.obs_dni,slug:r.params.slug};try{const t=await v({url:"mp/register-participant",method:"POST",data:a});if(t.status==200){if(r.query.ruc){const l={ruc:e.ruc,doc_number:e.documentnumber,slug:r.params.slug,attendance:1},n=await v({url:"mp/register-attendance",method:"POST",data:l})}if(setTimeout(()=>{E("registered",t)},700),s.detailEvent.link){const l={title:s.detailEvent.title,link:s.detailEvent.link,date:s.detailEvent.date,hourStart:s.detailEvent.hourStart,hourEnd:s.detailEvent.hourEnd,email:e.email},n=await v({url:"mp/send-event-email",method:"POST",data:l})}}}catch(t){console.log("Error: ",t)}finally{d.value=!1}},w=async(a,t)=>{try{const l=await v({url:a,method:"GET"}),n=f.find(k=>k.model===t);n&&l.data&&(n.options=l.data)}catch(l){console.error("Error de red:",l)}},{loadSectorEconomico:B,loadRubros:U,loadCountries:G,loadCity:L,loadTypeDocuments:W,loadGenders:X,loadCivilStatus:Z,loadAcademicDegree:J,loadRoleCompany:K}=ie(f);return P(async()=>{await B(),await U(),await L(),await W(),await X(),await Z(),await G(),await J(),await K(),e.country_id=155}),(a,t)=>(b(),S("div",he,[m(ae,{colorForm:"#7d4fc6",fields:f,onSearchDataApi:j,onSubmit:O,onChange:F,onHandleClearSearch:z},null,8,["fields"])]))}},Ee={class:"d-flex justify-center align-center flex-column"},ke={class:"text-center pa-8",style:{"max-width":"420px",width:"100%"}},xe={class:"text-center"},we={class:"d-flex flex-column align-center text-center"},Se={__name:"Sala",props:{detailEvent:{type:Object,default:()=>({})}},setup(x){const u=x,E=g(!0),s=de(()=>{const o=u.detailEvent;if(!(o!=null&&o.title)||!(o!=null&&o.date)||!(o!=null&&o.hourStart)||!(o!=null&&o.hourEnd))return null;const i=h(`${o.date} ${o.hourStart}`,"DD/MM/YYYY HH:mm:ss"),r=h(`${o.date} ${o.hourEnd}`,"DD/MM/YYYY HH:mm:ss");if(!i.isValid()||!r.isValid())return null;const d=i.format("YYYYMMDDTHHmmss"),D=r.format("YYYYMMDDTHHmmss"),e=`
    Capacitación ${o.modality}.
    Este es el link de la sala de la capacitación:
    ${o.link}
      `.trim();return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(o.title)}&dates=${d}/${D}&details=${encodeURIComponent(e)}&location=${encodeURIComponent(o.modality==="VIRTUAL"?"Evento Virtual":o.place??"")}`}),y=()=>{const o=h(),i=h(u.detailEvent.date,"DD/MM/YYYY");if(!o.isSame(i,"day"))return!1;const r=h(`${u.detailEvent.date} ${u.detailEvent.hourStart}`,"DD/MM/YYYY HH:mm:ss"),d=h(`${u.detailEvent.date} ${u.detailEvent.hourEnd}`,"DD/MM/YYYY HH:mm:ss");return o.isAfter(r)&&o.isBefore(d)};return(o,i)=>(b(),S(ce,null,[c("div",Ee,[i[5]||(i[5]=c("p",{class:"p-success mb-6",style:{color:"#7d4fc6"}},"Ya estás registrado",-1)),i[6]||(i[6]=c("p",{class:"p-comunity",style:{color:"#7d4fc6"}},[p(" Únete al grupo de "),c("b",{style:{color:"#4caf50"}},"whatsapp"),p(" para recibir avisos y enviarte el "),c("b",null,"link"),p(" de la "),c("b",null,"capacitación"),p(". ")],-1)),c("div",ke,[m($,{style:{padding:"2rem 0"},color:"success",size:"large",rounded:"pill",class:"text-none font-weight-medium mb-8",block:"","prepend-icon":"mdi-whatsapp",href:"https://chat.whatsapp.com/Duvnw4PInZc4MUs84WE0jX",target:"_blank"},{default:_(()=>i[1]||(i[1]=[p(" Unirme al grupo de WhatsApp ")])),_:1,__:[1]}),y()?(b(),Y($,{key:0,color:"#7d4fc6",size:"large",rounded:"pill",class:"text-none font-weight-medium mb-8",block:"","prepend-icon":"mdi-video",href:x.detailEvent.link,target:"_blank"},{default:_(()=>i[2]||(i[2]=[p(" Ingresar a la sala virtual ")])),_:1,__:[2]},8,["href"])):M("",!0),s.value?(b(),Y($,{key:1,style:{padding:"2rem 0"},color:"#fbc311",size:"large",rounded:"pill",class:"text-none font-weight-medium mb-8",block:"","prepend-icon":"mdi-calendar-plus",href:s.value,target:"_blank"},{default:_(()=>i[3]||(i[3]=[p(" Agendar en Google Calendar ")])),_:1,__:[3]},8,["href"])):M("",!0),m($,{style:{padding:"2rem 0"},color:"#eec8fc",size:"large",rounded:"pill",class:"text-none font-weight-medium mb-3",block:"","prepend-icon":"mdi-school",href:"/mujer-produce-eventos",target:"_blank"},{default:_(()=>i[4]||(i[4]=[p(" Ver más capacitaciones ")])),_:1,__:[4]})])]),c("div",xe,[m(_e,{modelValue:E.value,"onUpdate:modelValue":i[0]||(i[0]=r=>E.value=r),location:"top right",vertical:"",color:"white",class:"pa-4",timeout:12e3},{default:_(()=>[c("div",we,[m(se,{size:"80",color:"success",class:"mb-4"},{default:_(()=>i[7]||(i[7]=[p(" mdi-check-circle-outline ")])),_:1,__:[7]}),i[8]||(i[8]=c("h2",{class:"text-h5 font-weight-semibold mb-2"},"¡Registro confirmado!",-1)),i[9]||(i[9]=c("p",{class:"text-body-1 text-medium-emphasis mb-6"},[p(" Gracias por registrarte a este evento."),c("br"),p(" Te esperamos en el evento. ")],-1))])]),_:1},8,["modelValue"])])],64))}},Ye=ne(Se,[["__scopeId","data-v-043d2328"]]),$e={key:0,class:"mp",style:{"min-height":"calc(100vh - 390px)"}},De={key:1,class:"text-center"},qe={key:1},Je={__name:"[slug]",setup(x){ee("Mujer Produce | Registro","Formulario de registro para el Evento de Producción de Mujeres","mp-ico.ico");const u=g(!0),E=N(),s=g(!0),y=g({}),o=r=>{r&&(u.value=!1)},i=async()=>{try{const r=E.params.slug,d=await v({url:`mp/info-event-public/${r}`,method:"GET"});d.status===200&&(y.value=(d==null?void 0:d.data)||{}),console.log("response",d)}catch(r){console.error("Error de red:",r)}finally{s.value=!1}};return P(async()=>{await i()}),(r,d)=>(b(),Y(fe,{class:"py-0",fluid:""},{default:_(()=>[m(be,{align:"center",justify:"center"},{default:_(()=>[m(ye,{cols:"12",sm:"12",md:"10",lg:"8",xl:"6",class:"my-2"},{default:_(()=>[m(me,{"model-value":s.value,class:"align-center justify-center",persistent:"",scrim:""},{default:_(()=>[m(ue,{color:"#7d4fc6",size:"64",indeterminate:""})]),_:1},8,["model-value"]),s.value?M("",!0):(b(),Y(ve,{key:0,elevation:"8",rounded:"lg"},{default:_(()=>[m(te,{detailEvent:y.value},null,8,["detailEvent"]),y.value.finished?(b(),S("div",qe,[m(pe)])):(b(),S("div",$e,[u.value?(b(),Y(ge,{key:0,onRegistered:o,detailEvent:y.value},null,8,["detailEvent"])):(b(),S("div",De,[m(Ye,{detailEvent:y.value},null,8,["detailEvent"])]))]))]),_:1}))]),_:1})]),_:1})]),_:1}))}};export{Je as default};
