import{u as pe,f as Ie,g as Me,h as Ae,i as ne,j as De,k as Pe,e as Ke,l as _e}from"./VSelect-H6yxY4x-.js";import{E as ce,au as L,g as b,u as z,av as Re,aw as ee,ax as Le,b as p,C as H,F as G,D as Ee,ay as Oe,r as U,az as Te,G as Z,aA as Be,ao as $,ap as ue,J as je,M as Ne,j as oe,a as x,p as O,aq as ze,aB as Ue,aC as $e,aD as He,aE as se,aF as ie,aG as Ge,V as re,aH as Je,aI as Qe,aJ as We,Q as Xe,R as Ye,e as Ze}from"./index-CvE8iilx.js";const qe=(e,u,t)=>{if(e==null||u==null)return-1;if(!u.length)return 0;e=e.toString().toLocaleLowerCase(),u=u.toString().toLocaleLowerCase();const c=[];let o=e.indexOf(u);for(;~o;)c.push([o,o+u.length]),o=e.indexOf(u,o+u.length);return c.length?c:-1};function q(e,u){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+u.length]]:Array.isArray(e[0])?e:[e]}const el=ce({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ll(e,u,t){var A;const c=[],o=(t==null?void 0:t.default)??qe,g=t!=null&&t.filterKeys?ee(t.filterKeys):!1,y=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return c;e:for(let F=0;F<e.length;F++){const[w,i=w]=ee(e[F]),D={},I={};let k=-1;if((u||y>0)&&!(t!=null&&t.noFilter)){if(typeof w=="object"){const v=g||Object.keys(i);for(const a of v){const T=Le(i,a),P=(A=t==null?void 0:t.customKeyFilter)==null?void 0:A[a];if(k=P?P(T,u,w):o(T,u,w),k!==-1&&k!==!1)P?D[a]=q(k,u):I[a]=q(k,u);else if((t==null?void 0:t.filterMode)==="every")continue e}}else k=o(w,u,w),k!==-1&&k!==!1&&(I.title=q(k,u));const K=Object.keys(I).length,_=Object.keys(D).length;if(!K&&!_||(t==null?void 0:t.filterMode)==="union"&&_!==y&&!K||(t==null?void 0:t.filterMode)==="intersection"&&(_!==y||!K))continue}c.push({index:F,matches:{...I,...D}})}return c}function tl(e,u,t,c){const o=L([]),g=L(new Map),y=b(()=>z(u));Re(()=>{const F=typeof t=="function"?t():z(t),w=typeof F!="string"&&typeof F!="number"?"":String(F),i=ll(y.value,w,{customKeyFilter:{...e.customKeyFilter,...z(c==null?void 0:c.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),D=z(u),I=[],k=new Map;i.forEach(K=>{let{index:_,matches:v}=K;const a=D[_];I.push(a),k.set(a.value,v)}),o.value=I,g.value=k});function A(F){return g.value.get(F.value)}return{filteredItems:o,filteredMatches:g,getMatches:A}}function al(e,u,t){return t==null||!t.length?u:t.map((c,o)=>{const g=o===0?0:t[o-1][1],y=[p("span",{class:H(`${e}__unmask`)},[u.slice(g,c[0])]),p("span",{class:H(`${e}__mask`)},[u.slice(c[0],c[1])])];return o===t.length-1&&y.push(p("span",{class:H(`${e}__unmask`)},[u.slice(c[1])])),p(G,null,[y])})}const nl=ce({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...el({filterKeys:["title"]}),...Me(),...$e(He({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ue({transition:!1})},"VAutocomplete"),sl=Ee()({name:"VAutocomplete",props:nl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,u){let{slots:t}=u;const{t:c}=Oe(),o=U(),g=L(!1),y=L(!0),A=L(!1),F=U(),w=U(),i=L(-1),{items:D,transformIn:I,transformOut:k}=pe(e),{textColorClasses:K,textColorStyles:_}=Te(()=>{var l;return(l=o.value)==null?void 0:l.color}),v=Z(e,"search",""),a=Z(e,"modelValue",[],l=>I(l===null?[null]:ee(l)),l=>{const n=k(l);return e.multiple?n:n[0]??null}),T=b(()=>typeof e.counterValue=="function"?e.counterValue(a.value):typeof e.counterValue=="number"?e.counterValue:a.value.length),P=Be(e),{filteredItems:J,getMatches:fe}=tl(e,D,()=>y.value?"":v.value),M=b(()=>e.hideSelected?J.value.filter(l=>!a.value.some(n=>n.value===l.value)):J.value),B=b(()=>!!(e.chips||t.chip)),E=b(()=>B.value||!!t.selection),ve=b(()=>a.value.map(l=>l.props.value)),Q=b(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&v.value===((n=M.value[0])==null?void 0:n.title))&&M.value.length>0&&!y.value&&!A.value}),j=b(()=>e.hideNoData&&!M.value.length||P.isReadonly.value||P.isDisabled.value),W=Z(e,"menu"),m=b({get:()=>W.value,set:l=>{var n;W.value&&!l&&((n=F.value)!=null&&n.Î¨openChildren.size)||l&&j.value||(W.value=l)}}),le=b(()=>m.value?e.closeText:e.openText),X=U(),de=Ie(X,o);function me(l){e.openOnClear&&(m.value=!0),v.value=""}function he(){j.value||(m.value=!0)}function ge(l){j.value||(g.value&&(l.preventDefault(),l.stopPropagation()),m.value=!m.value)}function ye(l){var n;l.key!==" "&&se(l)&&((n=o.value)==null||n.focus())}function Ve(l){var s,d,C,S,r;if(P.isReadonly.value)return;const n=(s=o.value)==null?void 0:s.selectionStart,f=a.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(m.value=!0),["Escape"].includes(l.key)&&(m.value=!1),Q.value&&["Enter","Tab"].includes(l.key)&&!a.value.some(V=>{let{value:h}=V;return h===M.value[0].value})&&R(M.value[0]),l.key==="ArrowDown"&&Q.value&&((d=X.value)==null||d.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&E.value&&a.value.length>0&&!v.value)return R(a.value[0],!1);if(~i.value){l.preventDefault();const V=i.value;R(a.value[i.value],!1),i.value=V>=f-1?f-2:V}else l.key==="Backspace"&&!v.value&&(i.value=f-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(i.value<0&&n&&n>0)return;const V=i.value>-1?i.value-1:f-1;if(a.value[V])i.value=V;else{const h=((C=v.value)==null?void 0:C.length)??null;i.value=-1,(S=o.value)==null||S.setSelectionRange(h,h)}}else if(l.key==="ArrowRight"){if(i.value<0)return;const V=i.value+1;a.value[V]?i.value=V:(i.value=-1,(r=o.value)==null||r.setSelectionRange(0,0))}else~i.value&&se(l)&&(i.value=-1)}function ke(l){if(ie(o.value,":autofill")||ie(o.value,":-webkit-autofill")){const n=D.value.find(f=>f.title===l.target.value);n&&R(n)}}function Fe(){var l;e.eager&&((l=w.value)==null||l.calculateVisibleItems())}function Ce(){var l;g.value&&(y.value=!0,(l=o.value)==null||l.focus())}function we(l){g.value=!0,setTimeout(()=>{A.value=!0})}function xe(l){A.value=!1}function Se(l){(l==null||l===""&&!e.multiple&&!E.value)&&(a.value=[])}const Y=L(!1);function R(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const f=a.value.findIndex(d=>(e.valueComparator||Ge)(d.value,l.value)),s=n??!~f;if(~f){const d=s?[...a.value,l]:[...a.value];d.splice(f,1),a.value=d}else s&&(a.value=[...a.value,l]);e.clearOnSelect&&(v.value="")}else{const f=n!==!1;a.value=f?[l]:[],v.value=f&&!E.value?l.title:"",ue(()=>{m.value=!1,y.value=!0})}}return $(g,(l,n)=>{var f;l!==n&&(l?(Y.value=!0,v.value=e.multiple||E.value?"":String(((f=a.value.at(-1))==null?void 0:f.props.title)??""),y.value=!0,ue(()=>Y.value=!1)):(!e.multiple&&v.value==null&&(a.value=[]),m.value=!1,(e.multiple||E.value)&&(v.value=""),i.value=-1))}),$(v,l=>{!g.value||Y.value||(l&&(m.value=!0),y.value=!l)}),$(m,()=>{if(!e.hideSelected&&m.value&&a.value.length){const l=M.value.findIndex(n=>a.value.some(f=>n.value===f.value));je&&window.requestAnimationFrame(()=>{var n;l>=0&&((n=w.value)==null||n.scrollToIndex(l))})}}),$(()=>e.items,(l,n)=>{m.value||g.value&&!n.length&&l.length&&(m.value=!0)}),Ne(()=>{const l=!!(!e.hideNoData||M.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),n=a.value.length>0,f=oe.filterProps(e);return x(oe,O({ref:o},f,{modelValue:v.value,"onUpdate:modelValue":[s=>v.value=s,Se],focused:g.value,"onUpdate:focused":s=>g.value=s,validationValue:a.externalValue,counterValue:T.value,dirty:n,onChange:ke,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":m.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!E.value,"v-autocomplete--selecting-index":i.value>-1},e.class],style:e.style,readonly:P.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":me,"onMousedown:control":he,onKeydown:Ve}),{...t,default:()=>p(G,null,[x(Qe,O({ref:F,modelValue:m.value,"onUpdate:modelValue":s=>m.value=s,activator:"parent",contentClass:"v-autocomplete__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Fe,onAfterLeave:Ce},e.menuProps),{default:()=>[l&&x(Ae,O({ref:X,selected:ve.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:s=>s.preventDefault(),onKeydown:ye,onFocusin:we,onFocusout:xe,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},de,e.listProps),{default:()=>{var s,d,C;return[(s=t["prepend-item"])==null?void 0:s.call(t),!M.value.length&&!e.hideNoData&&(((d=t["no-data"])==null?void 0:d.call(t))??x(ne,{key:"no-data",title:c(e.noDataText)},null)),x(De,{ref:w,renderless:!0,items:M.value,itemKey:"value"},{default:S=>{var ae;let{item:r,index:V,itemRef:h}=S;const te=O(r.props,{ref:h,key:r.value,active:Q.value&&V===0?!0:void 0,onClick:()=>R(r,null)});return((ae=t.item)==null?void 0:ae.call(t,{item:r,index:V,props:te}))??x(ne,O(te,{role:"option"}),{prepend:N=>{let{isSelected:be}=N;return p(G,null,[e.multiple&&!e.hideSelected?x(Pe,{key:r.value,modelValue:be,ripple:!1,tabindex:"-1"},null):void 0,r.props.prependAvatar&&x(Ke,{image:r.props.prependAvatar},null),r.props.prependIcon&&x(re,{icon:r.props.prependIcon},null)])},title:()=>{var N;return y.value?r.title:al("v-autocomplete",r.title,(N=fe(r))==null?void 0:N.title)}})}}),(C=t["append-item"])==null?void 0:C.call(t)]}})]}),a.value.map((s,d)=>{function C(h){h.stopPropagation(),h.preventDefault(),R(s,!1)}const S={"onClick:close":C,onKeydown(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),h.stopPropagation(),C(h))},onMousedown(h){h.preventDefault(),h.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},r=B.value?!!t.chip:!!t.selection,V=r?We(B.value?t.chip({item:s,index:d,props:S}):t.selection({item:s,index:d})):void 0;if(!(r&&!V))return p("div",{key:s.value,class:H(["v-autocomplete__selection",d===i.value&&["v-autocomplete__selection--selected",K.value]]),style:Xe(d===i.value?_.value:{})},[B.value?t.chip?x(Ye,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:s.title}}},{default:()=>[V]}):x(_e,O({key:"chip",closable:e.closableChips,size:"small",text:s.title,disabled:s.props.disabled},S),null):V??p("span",{class:"v-autocomplete__selection-text"},[s.title,e.multiple&&d<a.value.length-1&&p("span",{class:"v-autocomplete__selection-comma"},[Ze(",")])])])})]),"append-inner":function(){var S,r;for(var s=arguments.length,d=new Array(s),C=0;C<s;C++)d[C]=arguments[C];return p(G,null,[(S=t["append-inner"])==null?void 0:S.call(t,...d),e.menuIcon?x(re,{class:"v-autocomplete__menu-icon",color:(r=o.value)==null?void 0:r.fieldIconColor,icon:e.menuIcon,onMousedown:ge,onClick:Je,"aria-label":c(le.value),title:c(le.value),tabindex:"-1"},null):void 0])}})}),ze({isFocused:g,isPristine:y,menu:m,search:v,filteredItems:J,select:R},o)}});export{sl as V};
