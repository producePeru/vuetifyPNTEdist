import{r as _,L as W,x as A,j as H,M as pe,f as v,o as p,a as m,w as c,F as D,N as ie,c as f,O as ye,C as F,E as n,b as Z,t as J,D as q,I as Q,V as de,e as U,P as be,B as ge,G as he,H as me,Q as ve,R as fe,J as _e,K as Ve,S as we,m as $e,y as ke,v as Se,A as xe,T as X}from"./index-99AdKl_5.js";import{c as w,m as Ce,u as De}from"./index-kctLoKo5.js";import{V as Fe,h as B}from"./VTooltip-Cj3rEd3a.js";import{a as ee,V as oe}from"./VRow-DwrrmD5t.js";import{V as ce}from"./VAutocomplete-tvexeV3J.js";import{V as qe,a as ue,d as Ee}from"./VDialog-BrTkzBzV.js";import{V as Te}from"./VForm-GFmn-gVH.js";import{V as Ue}from"./VSnackbar-BOb9QD_Q.js";import{V as Ae}from"./VContainer-Cz1sK9iG.js";import{f as Ne}from"./format-BWHQx2uA.js";import"./VSelect-ydnfoNAd.js";import"./VAvatar-jV72lSRD.js";const Be={key:0},Me={class:"mt-4 mb-3"},Re={key:0,class:"text-red text-caption pl-4"},Pe={__name:"FormComponent",props:{fields:Array,colorForm:"red"},emits:["submit","change","searchDataApi"],setup(b,{emit:o}){const h=o,$=b,g=_(null),r=W("formState");if(!r)throw new Error("❌ formState no fue proporcionado desde el componente padre.");const V=W("loadingStates"),M=W("loadingSubmit",_(!1));_(!1),_(!1);const E=_(!1),k=_(""),S=A({}),x=A({}),R=H(()=>{const t=new Date;return t.setFullYear(t.getFullYear()-18),t.toISOString().split("T")[0]});function P(t){S[t]=!0}function N(t){S[t]=!1}async function T(t){V[t]=!0,h("searchDataApi",t)}const z=_(["Facebook","Instagram","TikTok","Web"]),L=H(()=>{const t=r.socials.map(a=>a.name);return z.value.filter(a=>!t.includes(a))}),I=t=>{t&&!r.socials.find(a=>a.name===t)&&r.socials.push({name:t,link:""}),g.value=null},K=t=>{const a=r.socials.findIndex(e=>e.name===t);a!==-1&&r.socials.splice(a,1)},G={Facebook:"https://www.facebook.com/",Instagram:"https://www.instagram.com/",TikTok:"https://www.tiktok.com/@",Web:"https://www."},O=H(()=>{const t={};for(const a of $.fields){const e=[];a.required&&e.push(w.withMessage(`Es requerido: "${a.label}"`,s=>{const y=typeof a.condition=="function"?a.condition(r):!0;return a.type==="social"?!y||Array.isArray(s)&&s.length>0&&s.every(C=>C.link.trim()!==""):!y||w.req(s)})),a.max&&e.push(w.withMessage(`${a.label} debe tener máximo ${a.max} caracteres`,s=>!s||s.length<=a.max)),a.minLength&&e.push(w.withMessage(`${a.label} debe tener mínimo ${a.minLength} caracteres`,Ce(a.minLength))),a.model==="ruc"&&e.push(w.withMessage("Número de RUC no válido",s=>{if(!s)return!1;const y=String(s);return y.length===11&&["10","15","20"].includes(y.substring(0,2))})),a.model==="documentnumber"&&e.push(w.withMessage("Número de documento no válido",s=>{if(!s)return!1;const y=String(s);return r.typedocument_id===1?/^\d{8}$/.test(y):[2,3,4,5].includes(r.typedocument_id)?/^\d{1,12}$/.test(y):!1})),a.model==="phone"&&e.push(w.withMessage("Número de celular inválido",s=>{const y=String(s||"");return/^9\d{8}$/.test(y)})),a.model==="email"&&e.push(w.withMessage("Ingresa un correo válido",s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))),t[a.model]=e}return t}),u=De(O,r),j=(t,a)=>{h("change",{value:t,model:a},a)},i=async()=>{try{if(await u.value.$validate())h("submit");else{const a=$.fields.find(e=>{var s;return(s=u.value[e.model])==null?void 0:s.$invalid});a?(k.value=`Completa el campo "${a.label}"`,Ve(()=>{const e=document.querySelector(`[data-model="${a.model}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus())})):k.value="Corrige los errores del formulario",E.value=!0}}catch(t){console.error("Error en handleSubmit:",t)}};return pe(()=>{$.fields.forEach(t=>{if(t.type==="date"){const a=r[t.model];if(!a){x[t.model]="";return}const e=new Date(a),s=String(e.getDate()).padStart(2,"0"),y=String(e.getMonth()+1).padStart(2,"0"),C=e.getFullYear();x[t.model]=`${s}/${y}/${C}`}})}),(t,a)=>(p(),v(D,null,[m(Te,{onSubmit:me(i,["prevent"])},{default:c(()=>[m(ee,null,{default:c(()=>[(p(!0),v(D,null,ie(b.fields,e=>(p(),f(oe,{key:e.model,cols:e.cols||12,md:e.md||6,class:ye(e.py||"py-1")},{default:c(()=>{var s,y,C,ae,te,le,re,ne,se;return[!e.condition||e.condition(n(r))?(p(),v(D,{key:0},[e.type==="title"?(p(),v("div",Be,[Z("h4",Me,J(e.label),1)])):F("",!0),e.type==="text"?(p(),f(q,{key:1,label:e.label,modelValue:n(r)[e.model],"onUpdate:modelValue":l=>n(r)[e.model]=l,color:b.colorForm,"data-model":e.model,density:"comfortable",variant:"outlined","error-messages":(s=n(u)[e.model])==null?void 0:s.$errors.map(l=>l.$message),disabled:e.disabled,onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},null,8,["label","modelValue","onUpdate:modelValue","color","data-model","error-messages","disabled","onBlur"])):e.type==="select"?(p(),f(ce,{key:2,label:e.label,items:e.options,"onUpdate:modelValue":[l=>j(l,e.model),l=>n(r)[e.model]=l],"data-model":e.model,"item-title":"label","item-value":"value",color:b.colorForm,density:"comfortable",variant:"outlined","menu-props":{scrim:!0,scrollStrategy:"close"},modelValue:n(r)[e.model],"error-messages":(y=n(u)[e.model])==null?void 0:y.$errors.map(l=>l.$message),onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},null,8,["label","items","onUpdate:modelValue","data-model","color","modelValue","error-messages","onBlur"])):e.type==="social"?(p(),v(D,{key:3},[m(ce,{modelValue:g.value,"onUpdate:modelValue":[a[0]||(a[0]=l=>g.value=l),I],label:e.label,items:L.value,"data-model":e.model,density:"comfortable",color:b.colorForm,variant:"outlined","menu-props":{scrim:!0,scrollStrategy:"close"},placeholder:"Selecciona una red","hide-details":"",class:""},null,8,["modelValue","label","items","data-model","color"]),(C=n(u).socials)!=null&&C.$error?(p(),v("span",Re,J((te=(ae=n(u).socials)==null?void 0:ae.$errors[0])==null?void 0:te.$message),1)):F("",!0)],64)):e.type==="redes"?(p(!0),v(D,{key:4},ie(n(r).socials,(l,d)=>(p(),v("div",{key:l.name,class:"d-flex align-start",style:{gap:".5rem"}},[m(q,{label:`Link de ${l.name}`,prefix:G[l.name],density:"comfortable","data-model":e.model,color:b.colorForm,variant:"outlined",modelValue:n(r).socials[d].link,"onUpdate:modelValue":Y=>n(r).socials[d].link=Y},null,8,["label","prefix","data-model","color","modelValue","onUpdate:modelValue"]),m(Q,{icon:"",size:"30",color:"red",class:"mt-2",onClick:Y=>K(l.name)},{default:c(()=>[m(de,{size:"18"},{default:c(()=>a[4]||(a[4]=[U("mdi-close")])),_:1,__:[4]})]),_:2},1032,["onClick"])]))),128)):F("",!0),e.type==="number"?(p(),f(q,{key:5,label:e.label,modelValue:n(r)[e.model],"onUpdate:modelValue":l=>n(r)[e.model]=l,"data-model":e.model,color:b.colorForm,density:"comfortable",variant:"outlined",counter:e.max,maxlength:e.max,inputmode:"numeric",pattern:"[0-9]*",onKeypress:a[1]||(a[1]=l=>!/[0-9]/.test(l.key)&&l.preventDefault()),"error-messages":(le=n(u)[e.model])==null?void 0:le.$errors.map(l=>l.$message),onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},null,8,["label","modelValue","onUpdate:modelValue","data-model","color","counter","maxlength","error-messages","onBlur"])):F("",!0),e.type==="email"?(p(),f(q,{key:6,label:e.label,modelValue:n(r)[e.model],"onUpdate:modelValue":l=>n(r)[e.model]=l,"data-model":e.model,color:b.colorForm,density:"comfortable",variant:"outlined",type:"email",autocomplete:"email","error-messages":(re=n(u)[e.model])==null?void 0:re.$errors.map(l=>l.$message),onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},null,8,["label","modelValue","onUpdate:modelValue","data-model","color","error-messages","onBlur"])):e.type==="search"?(p(),f(q,{key:7,label:e.label,modelValue:n(r)[e.model],"onUpdate:modelValue":l=>n(r)[e.model]=l,disabled:e.disabled,"data-model":e.model,color:b.colorForm,density:"comfortable",variant:"outlined",counter:e.max,maxlength:e.max,inputmode:"numeric",pattern:"[0-9]*",loading:n(V)[e.model],"error-messages":(ne=n(u)[e.model])==null?void 0:ne.$errors.map(l=>l.$message),onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},{"append-inner":c(()=>[m(Fe,{text:"Click para buscar",location:"top"},{activator:c(({props:l})=>{var d;return[n(V)[e.model]?(p(),f(ge,{key:0,indeterminate:"",color:"primary",size:"20",class:"me-2"})):be((p(),f(de,he({key:1,ref_for:!0},l,{class:"me-2 input-search",onMousedown:a[2]||(a[2]=me(()=>{},["prevent"])),onClick:Y=>T(e.model)}),{default:c(()=>a[5]||(a[5]=[U(" mdi-magnify ")])),_:2,__:[5]},1040,["onClick"])),[[ve,String(n(r)[e.model]||"").length===e.max&&!((d=n(u)[e.model])!=null&&d.$invalid)&&!n(V)[e.model]]])]}),_:2},1024)]),_:2},1032,["label","modelValue","onUpdate:modelValue","disabled","data-model","color","counter","maxlength","loading","error-messages","onBlur"])):e.type==="date"?(p(),v(D,{key:8},[m(q,{label:e.label,modelValue:x[e.model],"onUpdate:modelValue":l=>x[e.model]=l,density:"comfortable","data-model":e.model,color:b.colorForm,variant:"outlined",onClick:l=>P(e.model),"error-messages":(se=n(u)[e.model])==null?void 0:se.$errors.map(l=>l.$message),onBlur:l=>{var d;return(d=n(u)[e.model])==null?void 0:d.$touch()}},null,8,["label","modelValue","onUpdate:modelValue","data-model","color","onClick","error-messages","onBlur"]),m(qe,{modelValue:S[e.model],"onUpdate:modelValue":l=>S[e.model]=l,width:"auto"},{default:c(()=>[m(ue,null,{default:c(()=>[m(fe,{modelValue:n(r)[e.model],"onUpdate:modelValue":[l=>n(r)[e.model]=l,()=>N(e.model)],max:R.value,color:"primary"},null,8,["modelValue","onUpdate:modelValue","max"]),m(Ee,null,{default:c(()=>[m(_e),m(Q,{text:"",onClick:l=>N(e.model)},{default:c(()=>a[6]||(a[6]=[U("Cancelar")])),_:2,__:[6]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):F("",!0)],64)):F("",!0)]}),_:2},1032,["cols","md","class"]))),128))]),_:1}),m(ee,{justify:"center",class:"mt-8"},{default:c(()=>[m(oe,{cols:"12",md:"6",class:"d-flex justify-center"},{default:c(()=>[m(Q,{type:"submit",color:b.colorForm,class:"btn-submit",size:"large",elevation:"2",loading:n(M)},{default:c(()=>a[7]||(a[7]=[U(" Enviar ")])),_:1,__:[7]},8,["color","loading"])]),_:1})]),_:1})]),_:1}),m(Ue,{modelValue:E.value,"onUpdate:modelValue":a[3]||(a[3]=e=>E.value=e),timeout:4e3,color:"red",location:"top"},{default:c(()=>[U(J(k.value),1)]),_:1},8,["modelValue"])],64))}},ze=b=>{const o=async(h,$)=>{try{const g=await B({url:$,method:"GET"}),r=b.find(V=>V.model===h);r&&g.data&&(r.options=g.data)}catch(g){console.error(`Error al cargar ${h}:`,g)}};return{loadSectorEconomico:()=>o("economicsector_id","select/economic-sectors"),loadRubros:()=>o("rubro_id","select/rubros"),loadActividadComercial:()=>o("comercialactivity_id","select/comercial-activities"),loadCity:()=>o("city_id","select/cities"),loadTypeDocuments:()=>o("typedocument_id","select/type-documents"),loadGenders:()=>o("gender_id","select/genders"),loadPropagandaMedia:()=>o("howKnowEvent_id","select/propaganda-media"),loadTaxpayerTypes:()=>o("typeContribuyente_id","select/type-taxpayer")}},Le={class:"fair-form"},eo={__name:"[slug]",setup(b){const o=A({socials:[]}),h=A({}),$=Se();xe();const g=_(!1);X("formState",o),X("loadingStates",h),X("loadingSubmit",g);const r=A([{type:"title",label:"Datos de la Empresa",md:12},{type:"search",label:"Número de RUC",model:"ruc",required:!0,max:11},{type:"text",label:"Razón Social",model:"razonSocial",required:!0,disabled:!0},{type:"text",label:"Nombre Comercial (marca)",model:"comercialName",required:!0},{type:"select",label:"Sector Económico",model:"economicsector_id",required:!0,options:[]},{type:"select",label:"Rubro",model:"rubro_id",required:!0,options:[]},{type:"select",label:"Actividad Comercial",model:"comercialactivity_id",required:!0,options:[]},{type:"select",label:"Región",model:"city_id",required:!0,options:[]},{type:"select",label:"Provincia",model:"province_id",required:!0,options:[]},{type:"select",label:"Distrito",model:"district_id",required:!0,options:[]},{type:"text",label:"Dirección",model:"address",required:!1},{type:"title",label:"Datos Personales",md:12},{type:"select",label:"Tipo de documento",model:"typedocument_id",required:!0,options:[]},{type:"search",label:"Número de Documento",model:"documentnumber",required:!0,max:8,disabled:!0},{type:"text",label:"Apellido Paterno",model:"lastname",required:!0,disabled:!0},{type:"text",label:"Apellido Materno",model:"middlename",required:!0,disabled:!0},{type:"text",label:"Nombres",model:"name",required:!0,disabled:!0},{type:"select",label:"Género",model:"gender_id",required:!0,options:[]},{type:"select",label:"¿Tiene alguna discapacidad?",model:"sick",required:!0,options:[{label:"Si",value:"yes"},{label:"No",value:"no"}]},{type:"number",label:"Número de celular",model:"phone",required:!0,max:9,minLength:9},{type:"email",label:"Correo electrónico",model:"email",required:!0},{type:"text",label:"Cargo en la empresa",model:"cargo_id",required:!0,options:[]},{type:"date",label:"Fecha de nacimiento",model:"birthday",required:!0},{type:"number",label:"Edad",model:"age",required:!1,max:2,minLength:2},{type:"title",label:"Detalles",md:12},{type:"select",label:"¿Cómo se enteró del evento?",model:"howKnowEvent_id",required:!0,options:[]}]),V=we(),M=_(!1);$e(M,i=>{V.global.name.value=i?"dark":"light"});const E=()=>{o.ruc=null,o.razonSocial=null,o.comercialName=null,o.economicsector_id=null,o.rubro_id=null,o.comercialactivity_id=null,o.city_id=null,o.province_id=null,o.district_id=null,o.address=null,o.howKnowEvent_id=null,o.typedocument_id=null},k=()=>{o.documentnumber=null,o.lastname=null,o.middlename=null,o.name=null,o.gender_id=null,o.sick=null,o.phone=null,o.email=null,o.birthday=null,o.cargo_id=null,o.age=null},S=()=>{["name","lastname","middlename"].forEach(i=>{const t=r.find(a=>a.model===i);t&&(t.disabled=!1)})},x=()=>{["name","lastname","middlename"].forEach(i=>{const t=r.find(a=>a.model===i);t&&(t.disabled=!0)})},R=(i,t)=>{if(i.model=="typedocument_id"){const a=r.find(e=>e.model==="documentnumber");a.disabled=!1,k()}if(i.model=="city_id"){o.province_id=null,o.district_id=null;const a=`select/provinces/${i.value}`;T(a,"province_id")}if(i.model=="province_id"){o.district_id=null;const a=`select/districts/${i.value}`;T(a,"district_id")}if(i.model=="typedocument_id"){console.log("oaoaoaoaoao",i,t);const a=r.find(e=>e.model==="documentnumber");i.value==1?(a.max=8,x()):a.max=9}},P=async i=>{let t=null;if(i=="ruc"&&(t=`public/consult-company-ruc/${o.ruc}`),i=="documentnumber")if(o.typedocument_id=="1")t=`public/consult-businessman-dni/${o.documentnumber}`;else return S(),h[i]=!1;try{const a=await B({url:t,method:"POST"});if(a.status==200){const{data:e}=a;if(i=="ruc"){if(o.comercialactivity_id=e.actividadComercial_id,o.condicion=e.condicion,o.address=e.direccion,o.estado=e.estado,o.razonSocial=e.razonSocial??null,o.city_id=e.region_id,e.region_id){const s=`select/provinces/${e.region_id}`;T(s,"province_id"),o.province_id=e.provincia_id}o.comercialName=e.rubro_id,o.economicsector_id=e.sectorEconomico_id}i=="documentnumber"&&(o.lastname=e.lastname,o.middlename=e.middlename,o.name=e.name,o.gender_id=e.gender_id,o.phone=e.phone,o.birthday=e.birthday)}}catch(a){console.log(a)}finally{h[i]=!1}},N=async()=>{const i={ruc:o.ruc,comercialName:o.comercialName,socialReason:o.razonSocial,economicsector_id:o.economicsector_id,category_id:o.rubro_id,comercialactivity_id:o.comercialactivity_id,city_id:o.city_id,province_id:o.province_id,district_id:o.district_id,address:o.address,typedocument_id:o.typedocument_id,documentnumber:o.documentnumber,name:o.name,lastname:o.lastname,middlename:o.middlename,gender_id:o.gender_id,sick:o.sick,phone:o.phone,email:o.email,positionCompany:o.cargo_id,birthday:o.birthday?Ne(typeof o.birthday=="string"?new Date(o.birthday):o.birthday,"yyyy-MM-dd"):null,age:o.age,howKnowEvent_id:o.howKnowEvent_id,slug:$.params.slug};g.value=!0;try{const t=await B({url:"pnte-event/register-sed-event",method:"POST",data:i});t.status==200&&(alert("Asistencia registrada correctamente"),k(),E()),t.status==409&&alert("Ya estás registrado en este evento con este número de documento.")}catch(t){console.error("Error de red:",t)}finally{g.value=!1}},T=async(i,t)=>{try{const a=await B({url:i,method:"GET"}),e=r.find(s=>s.model===t);e&&a.data&&(e.options=a.data)}catch(a){console.error("Error de red:",a)}},{loadSectorEconomico:z,loadRubros:L,loadActividadComercial:I,loadCity:K,loadTypeDocuments:G,loadGenders:O,loadPropagandaMedia:u,loadTaxpayerTypes:j}=ze(r);return ke(async()=>{await z(),await L(),await j(),await I(),await K(),await G(),await O(),await u()}),(i,t)=>(p(),f(Ae,{class:"fill-height",fluid:""},{default:c(()=>[m(ee,{align:"center",justify:"center"},{default:c(()=>[m(oe,{cols:"12",sm:"10",md:"8",lg:"6"},{default:c(()=>[m(ue,{elevation:"4",rounded:"lg",class:"fair-card"},{default:c(()=>[t[0]||(t[0]=Z("h2",{class:"mb-6"},"Formulario de Asistencia al evento de SED - PUCALLPA",-1)),Z("div",Le,[m(Pe,{fields:r,onSearchDataApi:P,onSubmit:N,colorForm:"#02E4A5",onChange:R},null,8,["fields"])])]),_:1,__:[0]})]),_:1})]),_:1})]),_:1}))}};export{eo as default};
