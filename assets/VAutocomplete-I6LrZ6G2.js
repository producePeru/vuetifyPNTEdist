import{O as pe,s as E,v as P,y as G,aX as Te,bm as ue,bn as Be,d as _,T as J,F as Y,N as Ne,Q as ze,r as W,al as $e,bo as je,ag as ae,bc as Ue,E as He,k as X,D as ve,av as Qe,S as Ge,x as fe,e as p,z as L,aG as We,aH as Xe,bd as Je,bp as de,bq as me,br as Ye,V as he,bs as Ze,bt as qe,bu as el,q as ll,ac as tl,g as al}from"./index-COPNUJwV.js";import{u as nl,e as ul,f as rl,g as il,b as sl}from"./VSnackbar-8Q-kV1ny.js";import{f as ol,a as cl,b as ge,e as vl,g as fl,d as ye}from"./VList-D3PEtADa.js";import{a as dl}from"./VAvatar-B0oKhBPp.js";const ml=(e,r,t)=>{if(e==null||r==null)return-1;if(!r.length)return 0;e=e.toString().toLocaleLowerCase(),r=r.toString().toLocaleLowerCase();const d=[];let i=e.indexOf(r);for(;~i;)d.push([i,i+r.length]),i=e.indexOf(r,i+r.length);return d.length?d:-1};function ne(e,r){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+r.length]]:Array.isArray(e[0])?e:[e]}const hl=pe({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function gl(e,r,t){var S;const d=[],i=(t==null?void 0:t.default)??ml,m=t!=null&&t.filterKeys?ue(t.filterKeys):!1,v=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return d;let b=null;e:for(let w=0;w<e.length;w++){const[a,x=a]=ue(e[w]),M={},K={};let k=-1;if((r||v>0)&&!(t!=null&&t.noFilter)){let N=!1;if(typeof a=="object"){if(a.type==="divider"||a.type==="subheader"){(b==null?void 0:b.type)==="divider"&&a.type==="subheader"&&d.push(b),b={index:w,matches:{},type:a.type};continue}const f=m||Object.keys(x);N=f.length===v;for(const u of f){const j=Be(x,u),A=(S=t==null?void 0:t.customKeyFilter)==null?void 0:S[u];if(k=A?A(j,r,a):i(j,r,a),k!==-1&&k!==!1)A?M[u]=ne(k,r):K[u]=ne(k,r);else if((t==null?void 0:t.filterMode)==="every")continue e}}else k=i(a,r,a),k!==-1&&k!==!1&&(K.title=ne(k,r));const T=Object.keys(K).length,O=Object.keys(M).length;if(!T&&!O||(t==null?void 0:t.filterMode)==="union"&&O!==v&&!T||(t==null?void 0:t.filterMode)==="intersection"&&(O!==v||!T&&v>0&&!N))continue}b&&(d.push(b),b=null),d.push({index:w,matches:{...K,...M}})}return d}function yl(e,r,t,d){const i=E([]),m=E(new Map),v=P(()=>G(r));Te(()=>{const S=typeof t=="function"?t():G(t),w=typeof S!="string"&&typeof S!="number"?"":String(S),a=gl(v.value,w,{customKeyFilter:{...e.customKeyFilter,...G(d==null?void 0:d.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),x=G(r),M=[],K=new Map;a.forEach(k=>{let{index:N,matches:T}=k;const O=x[N];M.push(O),K.set(O.value,T)}),i.value=M,m.value=K});function b(S){return m.value.get(S.value)}return{filteredItems:i,filteredMatches:m,getMatches:b}}function pl(e,r,t){return t==null||!t.length?r:t.map((d,i)=>{const m=i===0?0:t[i-1][1],v=[_("span",{class:J(`${e}__unmask`)},[r.slice(m,d[0])]),_("span",{class:J(`${e}__mask`)},[r.slice(d[0],d[1])])];return i===t.length-1&&v.push(_("span",{class:J(`${e}__unmask`)},[r.slice(d[1])])),_(Y,null,[v])})}const bl=pe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...hl({filterKeys:["title"]}),...rl(),...Xe(Je({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),Sl=Ne()({name:"VAutocomplete",props:bl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,r){let{slots:t}=r;const{t:d}=ze(),i=W(),m=E(!1),v=E(!0),b=E(!1),S=W(),w=W(),a=E(-1),x=E(null),{items:M,transformIn:K,transformOut:k}=ol(e),{textColorClasses:N,textColorStyles:T}=$e(()=>{var l;return(l=i.value)==null?void 0:l.color}),{InputIcon:O}=je(e),f=ae(e,"search",""),u=ae(e,"modelValue",[],l=>K(l===null?[null]:ue(l)),l=>{const n=k(l);return e.multiple?n:n[0]??null}),j=P(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:u.value.length),A=Ue(e),{filteredItems:Z,getMatches:be}=yl(e,M,()=>x.value??(v.value?"":f.value)),R=P(()=>e.hideSelected&&x.value===null?Z.value.filter(l=>!u.value.some(n=>n.value===l.value)):Z.value),re=He(()=>e.closableChips&&!A.isReadonly.value&&!A.isDisabled.value),U=P(()=>!!(e.chips||t.chip)),z=P(()=>U.value||!!t.selection),Ve=P(()=>u.value.map(l=>l.props.value)),$=P(()=>R.value.find(l=>l.type==="item"&&!l.props.disabled)),q=P(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&f.value===((n=$.value)==null?void 0:n.title))&&R.value.length>0&&!v.value&&!b.value}),H=P(()=>e.hideNoData&&!R.value.length||A.isReadonly.value||A.isDisabled.value),ee=ae(e,"menu"),h=P({get:()=>ee.value,set:l=>{var n;ee.value&&!l&&((n=S.value)!=null&&n.Î¨openChildren.size)||l&&H.value||(ee.value=l)}}),{menuId:ke,ariaExpanded:Fe,ariaControls:Ce}=nl(e,h),le=W(),Se=ul(le,i);function we(l){e.openOnClear&&(h.value=!0),f.value=""}function xe(){H.value||(h.value=!0)}function Ie(l){H.value||(m.value&&(l.preventDefault(),l.stopPropagation()),h.value=!h.value)}function Me(l){var n;(de(l)||l.key==="Backspace")&&((n=i.value)==null||n.focus())}function Ae(l){var g,F,o,V,I;if(A.isReadonly.value)return;const n=(g=i.value)==null?void 0:g.selectionStart,c=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(h.value=!0),["Escape"].includes(l.key)&&(h.value=!1),q.value&&["Enter","Tab"].includes(l.key)&&$.value&&!u.value.some(y=>{let{value:s}=y;return s===$.value.value})&&B($.value),l.key==="ArrowDown"&&q.value&&((F=le.value)==null||F.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&z.value&&u.value.length>0&&!f.value)return B(u.value[0],!1);if(~a.value){l.preventDefault();const y=a.value;B(u.value[a.value],!1),a.value=y>=c-1?c-2:y}else l.key==="Backspace"&&!f.value&&(a.value=c-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(a.value<0&&n&&n>0)return;const y=a.value>-1?a.value-1:c-1;if(u.value[y])a.value=y;else{const s=((o=f.value)==null?void 0:o.length)??null;a.value=-1,(V=i.value)==null||V.setSelectionRange(s,s)}}else if(l.key==="ArrowRight"){if(a.value<0)return;const y=a.value+1;u.value[y]?a.value=y:(a.value=-1,(I=i.value)==null||I.setSelectionRange(0,0))}else~a.value&&de(l)&&(a.value=-1)}function De(l){if(me(i.value,":autofill")||me(i.value,":-webkit-autofill")){const n=M.value.find(c=>c.title===l.target.value);n&&B(n)}}function Pe(){var l;e.eager&&((l=w.value)==null||l.calculateVisibleItems())}function _e(){var l;m.value&&(v.value=!0,(l=i.value)==null||l.focus()),x.value=null}function Ke(l){m.value=!0,setTimeout(()=>{b.value=!0})}function Re(l){b.value=!1}function Le(l){(l==null||l===""&&!e.multiple&&!z.value)&&(u.value=[])}const te=E(!1);function B(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const c=u.value.findIndex(F=>(e.valueComparator||Ye)(F.value,l.value)),g=n??!~c;if(~c){const F=g?[...u.value,l]:[...u.value];F.splice(c,1),u.value=F}else g&&(u.value=[...u.value,l]);e.clearOnSelect&&(f.value="")}else{const c=n!==!1;u.value=c?[l]:[],x.value=v.value?"":f.value??"",f.value=c&&!z.value?l.title:"",ve(()=>{h.value=!1,v.value=!0})}}return X(m,(l,n)=>{var c;l!==n&&(l?(te.value=!0,f.value=e.multiple||z.value?"":String(((c=u.value.at(-1))==null?void 0:c.props.title)??""),v.value=!0,ve(()=>te.value=!1)):(!e.multiple&&f.value==null&&(u.value=[]),h.value=!1,!v.value&&f.value&&(x.value=f.value),f.value="",a.value=-1))}),X(f,l=>{!m.value||te.value||(l&&(h.value=!0),v.value=!l)}),X(h,l=>{if(!e.hideSelected&&l&&u.value.length&&v.value){const n=R.value.findIndex(c=>u.value.some(g=>c.value===g.value));Qe&&window.requestAnimationFrame(()=>{var c;n>=0&&((c=w.value)==null||c.scrollToIndex(n))})}l&&(x.value=null)}),X(M,(l,n)=>{h.value||m.value&&!n.length&&l.length&&(h.value=!0)}),Ge(()=>{const l=!!(!e.hideNoData||R.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),n=u.value.length>0,c=fe.filterProps(e);return p(fe,L({ref:i},c,{modelValue:f.value,"onUpdate:modelValue":[g=>f.value=g,Le],focused:m.value,"onUpdate:focused":g=>m.value=g,validationValue:u.externalValue,counterValue:j.value,dirty:n,onChange:De,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":h.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!z.value,"v-autocomplete--selecting-index":a.value>-1},e.class],style:e.style,readonly:A.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":we,"onMousedown:control":xe,onKeydown:Ae,"aria-expanded":Fe.value,"aria-controls":Ce.value}),{...t,default:g=>{let{id:F}=g;return _(Y,null,[p(qe,L({id:ke.value,ref:S,modelValue:h.value,"onUpdate:modelValue":o=>h.value=o,activator:"parent",contentClass:"v-autocomplete__content",disabled:H.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Pe,onAfterLeave:_e},e.menuProps),{default:()=>[l&&p(cl,L({ref:le,filterable:!0,selected:Ve.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:o=>o.preventDefault(),onKeydown:Me,onFocusin:Ke,onFocusout:Re,tabindex:"-1",selectable:!!R.value.length,"aria-live":"polite","aria-labelledby":`${F.value}-label`,"aria-multiselectable":e.multiple,color:e.itemColor??e.color},Se,e.listProps),{default:()=>{var o,V,I;return[(o=t["prepend-item"])==null?void 0:o.call(t),!R.value.length&&!e.hideNoData&&(((V=t["no-data"])==null?void 0:V.call(t))??p(ge,{key:"no-data",title:d(e.noDataText)},null)),p(il,{ref:w,renderless:!0,items:R.value,itemKey:"value"},{default:y=>{var se,oe,ce;let{item:s,index:D,itemRef:C}=y;const ie=L(s.props,{ref:C,key:s.value,active:q.value&&s===$.value?!0:void 0,onClick:()=>B(s,null),"aria-posinset":D+1,"aria-setsize":R.value.length});return s.type==="divider"?((se=t.divider)==null?void 0:se.call(t,{props:s.raw,index:D}))??p(vl,L(s.props,{key:`divider-${D}`}),null):s.type==="subheader"?((oe=t.subheader)==null?void 0:oe.call(t,{props:s.raw,index:D}))??p(fl,L(s.props,{key:`subheader-${D}`}),null):((ce=t.item)==null?void 0:ce.call(t,{item:s,index:D,props:ie}))??p(ge,L(ie,{role:"option"}),{prepend:Q=>{let{isSelected:Oe}=Q;return _(Y,null,[e.multiple&&!e.hideSelected?p(sl,{key:s.value,modelValue:Oe,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Ee=>Ee.preventDefault()},null):void 0,s.props.prependAvatar&&p(dl,{image:s.props.prependAvatar},null),s.props.prependIcon&&p(he,{icon:s.props.prependIcon},null)])},title:()=>{var Q;return v.value?s.title:pl("v-autocomplete",s.title,(Q=be(s))==null?void 0:Q.title)}})}}),(I=t["append-item"])==null?void 0:I.call(t)]}})]}),u.value.map((o,V)=>{function I(C){C.stopPropagation(),C.preventDefault(),B(o,!1)}const y=L(ye.filterProps(o.props),{"onClick:close":I,onKeydown(C){C.key!=="Enter"&&C.key!==" "||(C.preventDefault(),C.stopPropagation(),I(C))},onMousedown(C){C.preventDefault(),C.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),s=U.value?!!t.chip:!!t.selection,D=s?el(U.value?t.chip({item:o,index:V,props:y}):t.selection({item:o,index:V})):void 0;if(!(s&&!D))return _("div",{key:o.value,class:J(["v-autocomplete__selection",V===a.value&&["v-autocomplete__selection--selected",N.value]]),style:ll(V===a.value?T.value:{})},[U.value?t.chip?p(tl,{key:"chip-defaults",defaults:{VChip:{closable:re.value,size:"small",text:o.title}}},{default:()=>[D]}):p(ye,L({key:"chip",closable:re.value,size:"small",text:o.title,disabled:o.props.disabled},y),null):D??_("span",{class:"v-autocomplete__selection-text"},[o.title,e.multiple&&V<u.value.length-1&&_("span",{class:"v-autocomplete__selection-comma"},[al(",")])])])})])},"append-inner":function(){var V,I;for(var g=arguments.length,F=new Array(g),o=0;o<g;o++)F[o]=arguments[o];return _(Y,null,[(V=t["append-inner"])==null?void 0:V.call(t,...F),e.menuIcon?p(he,{class:"v-autocomplete__menu-icon",color:(I=i.value)==null?void 0:I.fieldIconColor,icon:e.menuIcon,onMousedown:Ie,onClick:Ze,"aria-hidden":!0,tabindex:"-1"},null):void 0,e.appendInnerIcon&&p(O,{key:"append-icon",name:"appendInner",color:F[0].iconColor.value},null)])}})}),We({isFocused:m,isPristine:v,menu:h,search:f,filteredItems:Z,select:B},i)}});export{Sl as V};
