import{_ as P}from"./FormComponent-DzkaaZsi.js";import{u as z}from"./useFormOptions-BD_ZbAMu.js";import{h as u}from"./httpRequest-D3KC4pOG.js";import{h as p,r as f,u as $,k as M,o as K,f as L,w as l,i as B,j as G,b as O,e as d,d as _,t as j,p as y}from"./index-C0gaUYyG.js";import{V as U}from"./VContainer-SoZtTZbj.js";import{a as Y,V as H}from"./VRow-ChXCX1hm.js";import{V as I}from"./VCard-NMHhxYgj.js";import{f as J}from"./format-BWHQx2uA.js";import"./index-CeceoFn_.js";import"./dayjs.min-BaPeHrhp.js";import"./VAutocomplete-Cc3wl0mU.js";import"./VList-DQsT9Fmy.js";import"./VDivider-BvDmpqQv.js";import"./VAvatar-DaqhRadI.js";import"./VDialog-_rbldzUr.js";import"./VForm-iFUsFC7V.js";import"./VSnackbar-CUmbrWdX.js";const Q={class:"fair-form"},ye={__name:"[slug]",setup(W){const e=p({socials:[]}),n=p({}),h=B();G();const c=f(!1);y("formState",e),y("loadingStates",n),y("loadingSubmit",c);const r=p([{type:"title",label:"Datos de la Empresa",md:12},{type:"search",label:"Número de RUC",model:"ruc",required:!0,max:11},{type:"text",label:"Razón Social",model:"razonSocial",required:!0,disabled:!0},{type:"text",label:"Nombre Comercial (marca)",model:"comercialName",required:!0},{type:"select",label:"Sector Económico",model:"economicsector_id",required:!0,options:[]},{type:"select",label:"Rubro",model:"rubro_id",required:!0,options:[]},{type:"select",label:"Actividad Comercial",model:"comercialactivity_id",required:!0,options:[]},{type:"select",label:"Región",model:"city_id",required:!0,options:[]},{type:"select",label:"Provincia",model:"province_id",required:!0,options:[]},{type:"select",label:"Distrito",model:"district_id",required:!0,options:[]},{type:"text",label:"Dirección",model:"address",required:!0},{type:"title",label:"Datos Personales",md:12},{type:"select",label:"Tipo de documento",model:"typedocument_id",required:!0,options:[]},{type:"search",label:"Número de Documento",model:"documentnumber",required:!0,max:8,disabled:!0},{type:"text",label:"Apellido Paterno",model:"lastname",required:!0,disabled:!0},{type:"text",label:"Apellido Materno",model:"middlename",required:!0,disabled:!0},{type:"text",label:"Nombres",model:"name",required:!0,disabled:!0},{type:"select",label:"Género",model:"gender_id",required:!0,options:[]},{type:"select",label:"¿Tiene alguna discapacidad?",model:"sick",required:!0,options:[{label:"Si",value:"yes"},{label:"No",value:"no"}]},{type:"number",label:"Número de celular",model:"phone",required:!0,max:9,minLength:9},{type:"email",label:"Correo electrónico",model:"email",required:!0},{type:"text",label:"Cargo en la empresa",model:"cargo_id",required:!0,options:[]},{type:"date",label:"Fecha de nacimiento",model:"birthday",required:!0},{type:"number",label:"Edad",model:"age",required:!0,max:2,minLength:2},{type:"title",label:"Detalles",md:12},{type:"select",label:"¿Cómo se enteró del evento?",model:"howKnowEvent_id",required:!0,options:[]}]),g=$(),v=f(!1);M(v,t=>{g.global.name.value=t?"dark":"light"});const q=()=>{e.ruc=null,e.razonSocial=null,e.comercialName=null,e.economicsector_id=null,e.rubro_id=null,e.comercialactivity_id=null,e.city_id=null,e.province_id=null,e.district_id=null,e.address=null,e.howKnowEvent_id=null,e.typedocument_id=null},b=()=>{e.documentnumber=null,e.lastname=null,e.middlename=null,e.name=null,e.gender_id=null,e.sick=null,e.phone=null,e.email=null,e.birthday=null,e.cargo_id=null,e.age=null},w=()=>{["name","lastname","middlename"].forEach(t=>{const a=r.find(o=>o.model===t);a&&(a.disabled=!1)})},S=()=>{["name","lastname","middlename"].forEach(t=>{const a=r.find(o=>o.model===t);a&&(a.disabled=!0)})},C=(t,a)=>{if(t.model=="typedocument_id"){const o=r.find(i=>i.model==="documentnumber");o.disabled=!1,b()}if(t.model=="city_id"){e.province_id=null,e.district_id=null;const o=`select/provinces/${t.value}`;s(o,"province_id")}if(t.model=="province_id"){e.district_id=null;const o=`select/districts/${t.value}`;s(o,"district_id")}if(t.model=="typedocument_id"){console.log("oaoaoaoaoao",t,a);const o=r.find(i=>i.model==="documentnumber");t.value==1?(o.max=8,S()):o.max=9}},x=async t=>{let a=null;if(t=="ruc"&&(a=`public/consult-company-ruc/${e.ruc}`),t=="documentnumber")if(e.typedocument_id=="1")a=`public/consult-businessman-dni/${e.documentnumber}`;else return w(),n[t]=!1;try{const o=await u({url:a,method:"POST"});if(o.status==200){const{data:i}=o;if(t=="ruc"){if(e.comercialactivity_id=i.actividadComercial_id,e.condicion=i.condicion,e.address=i.direccion,e.estado=i.estado,e.razonSocial=i.razonSocial??null,e.city_id=i.region_id,i.region_id){const m=`select/provinces/${i.region_id}`;s(m,"province_id"),e.province_id=i.provincia_id}e.comercialName=i.rubro_id,e.economicsector_id=i.sectorEconomico_id}t=="documentnumber"&&(e.lastname=i.lastname,e.middlename=i.middlename,e.name=i.name,e.gender_id=i.gender_id,e.phone=i.phone,e.birthday=i.birthday)}}catch(o){console.log(o)}finally{n[t]=!1}},E=async()=>{const t={ruc:e.ruc,comercialName:e.comercialName,socialReason:e.razonSocial,economicsector_id:e.economicsector_id,category_id:e.rubro_id,comercialactivity_id:e.comercialactivity_id,city_id:e.city_id,province_id:e.province_id,district_id:e.district_id,address:e.address,typedocument_id:e.typedocument_id,documentnumber:e.documentnumber,name:e.name,lastname:e.lastname,middlename:e.middlename,gender_id:e.gender_id,sick:e.sick,phone:e.phone,email:e.email,positionCompany:e.cargo_id,birthday:e.birthday?J(typeof e.birthday=="string"?new Date(e.birthday):e.birthday,"yyyy-MM-dd"):null,age:e.age,howKnowEvent_id:e.howKnowEvent_id,slug:h.params.slug};c.value=!0;try{const a=await u({url:"pnte-event/register-sed-event",method:"POST",data:t});a.status==200&&(alert("Asistencia registrada correctamente"),b(),q()),a.status==409&&alert("Ya estás registrado en este evento con este número de documento.")}catch(a){console.error("Error de red:",a)}finally{c.value=!1}},s=async(t,a)=>{try{const o=await u({url:t,method:"GET"}),i=r.find(m=>m.model===a);i&&o.data&&(i.options=o.data)}catch(o){console.error("Error de red:",o)}},{loadSectorEconomico:D,loadRubros:N,loadActividadComercial:A,loadCity:F,loadTypeDocuments:R,loadGenders:k,loadPropagandaMedia:T,loadTaxpayerTypes:V}=z(r);return K(async()=>{await D(),await N(),await V(),await A(),await F(),await R(),await k(),await T()}),(t,a)=>(O(),L(U,{class:"fill-height",fluid:""},{default:l(()=>[d(Y,{align:"center",justify:"center"},{default:l(()=>[d(H,{cols:"12",sm:"10",md:"8",lg:"6"},{default:l(()=>[d(I,{elevation:"4",rounded:"lg",class:"fair-card"},{default:l(()=>[a[0]||(a[0]=_("h2",{class:"mb-6"},"Formulario de Asistencia al evento de SED - PUCALLPA",-1)),_("div",Q,[d(P,{fields:r,onSearchDataApi:x,onSubmit:E,colorForm:"#02E4A5",onChange:C},null,8,["fields"])]),_("pre",null,j(e),1)]),_:1,__:[0]})]),_:1})]),_:1})]),_:1}))}};export{ye as default};
